{% extends base_template %}
{% load thumbnail django_static %}

{% block pagetitle %}Admin Home{% endblock %}

{% block extracss %}
<style type="text/css">


</style>
{% endblock %}


{% block content %}

            <div id="filters">
                <a href="/admin-stuff/?w=4">This Month</a> / 
                <a href="/admin-stuff/?w=12">3 Months</a> / 
                <a href="/admin-stuff/?w=24">6 Months</a> / 
                <a href="/admin-stuff/?w=52">12 Months</a> / 
                <a href="/admin-stuff/?w=1096">Forever</a>
            </div>
        {% if orders %}
            <h3>Recent orders ({{ orders.count }})</h3>

         	<table id="orders-table">
         		<thead>
         			<tr>
         			<td>Order ID</td>
         			<td>Owner</td>
         			<td>Items</td>
         			<td>Value</td>
         			<td>Status</td>
         			</tr>
         		</thead>
            	{% for order in orders %}
            		<tr id="{{ order.id }}" class="{% cycle '' 'white' %} {% ifequal order.status 'paid' %}new{% endifequal %}">
            			<td class="id" valign="top">
            				<a href="{% url admin_order order.id %}">{{ order }}</a><br/>
            				<span style="font-weight: normal">{{ order.date_paid|date:"d M y" }}</span>
            				{% if order.wishlist_payee %}
            				<br/><br/>
            				<span style="text-transform: uppercase;font-size: 10px; color: red;">WISHLIST PAID BY:</span><br/>
            				<span style="font-weight:normal;color:red; font-size: 10px;">{{ order.wishlist_payee }}</span>
            				{% endif %}
            			</td>
            			<td class="owner" valign="top">
            				<a href="{% url admin_shopper order.owner.id %}">{{ order.owner }}</a><br/>
            				{% with order.address as address %}
            				{% include 'shop/snippets/address.html' %}
            				{% endwith %}
            			</td>
            			<td class="items" valign="top">
            				<ul>
            				{% for item in order.get_items %}
            					<li><a href="{% url admin_product item.item.parent_product.id %}">{{ item }}</a></li>
            				{% endfor %}
            				</ul>
            			</td>
            			<td class="value" valign="top">
             				{{ order.get_amount }} {{ order.get_currency.code }}
            			</td>
            			<td class="status" valign="top">
            				<strong>{{ order.status }}</strong><br/>
            				{% if order.status == 'shipped' %}
            				  {% if order.review_email_sent %}
            				     review email sent
            				  {% else %}
            				    {% if order.ready_to_send_review %}
               				     <a href="{% url send_review_email order.id %}">Send review email</a>
               				    {% endif %}
            				  {% endif %}
            				{% endif %}
            				<br/>
            				{% if order.sampler_email_sent %}
            					{% if order.sampler_sent %}
            					sampler sent
            					{% else %}
            					sampler email sent
            					{% endif %}
            				{% else %}
            				  {% if order.ready_to_send_sampler_email %}
            					<a href="{% url send_sampler_email order.id %}">Send sampler email</a>
            				  {% endif %}
            				{% endif %}
            			</td>
            			<td class="trans" width="180px">
            				{% if order.status == 'paid' %}
            					<a title="Click to confirm this order has been sent (doesn't trigger any emails or anything sinister)" class="button" href="{% url ship_it order.id %}">Ship it!</a>		
            				{% endif %}
            				{% if order.status == 'shipped' and not order.postage_cost %}
            					<form id="postage_{{ order.id }}" action="{% url postage_cost_update order.id %}" method="post">
            						<label>What was the postage cost?</label><input type="text" name="cost" id="id_cost"/>
            						<input type="hidden" name="order" id="id_order" value="{{ order.id }}"/>
            						<input type="submit" value="Save" class="button"/>
            					</form>
            				{% endif %}
            				{% if order.postage_cost %}
            				{{ order.postage_cost }}
            				{% endif %}
            			</td>
            		</tr>
            	{% endfor %}
            	</table>
            	{% else %}
            	<p><em>No orders in the last 30 days</em></p>
            	{% endif %}



<h3>Unconfirmed orders</h3>
<table id="unconfirmed-orders">
	<thead>
		<tr>
			<td>Order ID</td>
			<td>Email address</td>
			<td>Items</td>
			<td></td>
		</tr>
	</thead>
	{% for order in unconfirmed_orders %}
	<tr>
		<td>{{ order.invoice_id }}</td>
		<td>{{ order.owner.email }}</td>
		<td>
			<ul>
			{% for item in order.items.all %}
				<li>{{ item }}</li>
			{% endfor %}
			</ul>
		</td>
		<td><a href="{% url send_reminder_email order.id %}">Send reminder email</a></td>
	</tr>
	{% endfor %}	

</table>


<h3>Giveaways ({{ orders.count }})</h3>
	<table id="orders-table">
		<thead>
			<tr>
			<td>Order ID</td>
			<td>Items</td>
			<td>Notes</td>
			<td>Date given</td>
			<td>Value</td>
			</tr>
		</thead>
	{% for order in giveaways %}
		<tr>
			<td><a href="{% url admin_order order.id %}">{{ order }}</a></td>
			<td>
				<ul>
				{% for item in order.get_items %}
					<li>{{ item }}</li>
				{% endfor %}
				</ul>
			</td>
			<td>{{ order.notes }}</td>
			<td>{{ order.date_paid }}</td>

			<td>
				{{ order.get_amount }}
			</td>
		</tr>
	{% empty %}
		<p>No current paid orders</p>
	{% endfor %}
	</table>

<h3>Email subscribers ({{ subscriber_count }})</h3>

<ul>
{% for s in subscribers %}
	<li>{{ s.email }}</li>
{% endfor %}
</ul>


{% endblock %}
