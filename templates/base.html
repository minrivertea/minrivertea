{% load nav_selected i18n %}

<html>
<head>

    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	{% get_current_language as LANGUAGE_CODE %}
	<meta content="{{ LANGUAGE_CODE }}" http-equiv="Content-Language" />
	<meta content="{% block metadescription %}{% endblock %}" name="description" />
	
	<meta name="msvalidate.01" content="D72BD43A6F271B73C8F653A920B8C23C" />
	{% if site_url == 'http://www.minrivertea.de' %}
	   <meta name="google-site-verification" content="gGvtp94ao-hoVvFl84NwBGMe2qvyNDZUHG2gH0Zo8go" />
    {% else %}
    	<meta name="google-site-verification" content="obu9NY_4FNbUQMNlrvWOk59ABZ9gROs37zTql__Lglo" />
    {% endif %}
	<META name="y_key" content="cfd80b8d388be931" />
    <meta name="p:domain_verify" content="36c2803570cf7e09f6e5cdb1ad355c49" /> <!-- PINTEREST -->
    <meta property="fb:admins" content="598410589" /> <!-- FACEBOOK INSIGHTS-->
	
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="generator" content="Django - http://www.djangoproject.com" />
	<meta name="DC.format" content="text/html" />
	<meta name="DC.type" content="Django Site" />
	<meta name="robots" content="ALL" />
	
	<title>{% block pagetitle %}{% endblock %} | {{ site_name }}</title>
	<link rel="shortcut icon" href="{{ static_url }}images/favicon.ico" type="image/x-icon">
	{% block canonical %}{% endblock %}
	{% block extra-head %}{% endblock %}

	<link rel="stylesheet" href="{{ static_url }}css/styles.css" />
	    
	{% if ga_is_on %}
		<script src="https://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="{{ static_url }}js/jquery.tools.min.js"></script>
	{% else %}
		<script src="{{ static_url }}js/jquery-1.8.2.min.js"></script>
		<script src="{{ static_url }}js/jquery.tools.min.js"></script>
	{% endif %}
	   
	{% block extracss %}{% endblock %}
	
	<link href='http://fonts.googleapis.com/css?family=Roboto:400,300,500,700' rel='stylesheet' type='text/css'>

    {% if request.LANGUAGE_CODE == 'de' %}
    <link rel="stylesheet" href="{{ static_url }}css/germany.css"/>
    {% endif %}
	
	<!--[if lte IE 8]>
		<link rel="stylesheet" media="screen" type="text/css" href="{{ static_url }}css/ie.css" />
	<![endif]-->

	
    {% block ga %}
    {% if ga_is_on %}
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', '{{ analytics_id }}']);
  _gaq.push(['_setDomainName', 'www.minrivertea.com']); 
  _gaq.push(['_trackPageview']);
  
  {% if "order/complete/" in request.path %}
  {% if order %}

  _gaq.push(['_addTrans',
    '{{ order.invoice_id }}',           // order ID - required
    'Min River Tea',  // affiliation or store name
    '{{ order.get_amount }}',          // total - required
    '',           // tax
    '',              // shipping
    '',       // city
    '',     // state or province
    ''             // country
  ]);

   {% for item in order.items.all %}
  _gaq.push(['_addItem',
    '{{ order.invoice_id }}',           // order ID - required
    '{{ item.item.parent_product.id }}',           // SKU/code - required
    '{{ item.item.parent_product.name }}',        // product name
    '{{ item.item.weight }}{{ item.item.weight_unit }}',   // category or variation
    '{{ item.item.price }}',          // unit price - required
    '1'               // quantity - required
  ]);
  {% endfor %}
  
  _gaq.push(['_trackTrans']); //submits transaction to the Analytics servers
  
  {% endif %}
  {% endif %}


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

{% if "order/complete" in request.path %}
{% if order %}
<!-- Google Code for Bought Something Conversion Page -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 970474503;
var google_conversion_language = "en";
var google_conversion_format = "2";
var google_conversion_color = "ffffff";
var google_conversion_label = "mTM9CJHq3AIQh4jhzgM";
var google_conversion_value = 0;
if (15.00) {
  google_conversion_value = 15.00;
}
/* ]]> */
</script>
<script type="text/javascript" src="https://www.googleadservices.com/pagead/conversion.js">
</script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/970474503/?value=15.00&amp;label=mTM9CJHq3AIQh4jhzgM&amp;guid=ON&amp;script=0"/>
</div>
</noscript>
{% endif %}
{% endif %}



    {% endif %}
        
    {% endblock %}
</head>



<body>	

{% if ga_is_on %}
<!-- FACEBOOK LIKE BUTTON JAVASCRIPT -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<!-- END FACEBOOK LIKE BUTTON JAVASCRIPT -->
{% endif %}


<!--
<div id="global-message">
    <div class="sp">
        <p></p>
    </div>
</div>
-->

<div id="header">

    <div class="sp">
        
        <div id="logo">
            <a title="{% trans 'Chinese tea delivered to your door - Min River Tea' %}" alt="{% trans 'the Min River Tea logo - Chinese tea merchant '%}" href="/"></a>
	   	</div>
	   		   	
        
    	<ul id="learn">
            {% for x in top_nav %}
              <li>
                <a href="{{ x.get_absolute_url }}">{{ x.title }}</a>
              </li>
            {% endfor %}
            
          	{% get_current_language as LANGUAGE_CODE %}
          	{% if LANGUAGE_CODE == 'en' %}
          	<li>
          	     <a href="{% url changelang 'de' %}">{% trans 'German' %}</a>
          	     <a href="{% url changelang 'it' %}">{% trans 'Italian' %}</a>
          	</li>
          	{% endif %}
          	
          	{% if LANGUAGE_CODE == 'de' %}
          	<li>
          	     <a href="{% url changelang 'en' %}">{% trans 'English' %}</a>
          	     <a href="{% url changelang 'it' %}">{% trans 'Italian' %}</a>
          	</li>
          	{% endif %}
          	
          	{% if LANGUAGE_CODE == 'it' %}
          	<li>
          	     <a href="{% url changelang 'en' %}">{% trans 'English' %}</a>
          	     <a href="{% url changelang 'de' %}">{% trans 'German' %}</a>
          	</li>
          	{% endif %}

        </ul>
    	        
        {% include 'shop/snippets/main_navigation.html' %}
        
        <div class="hr"></div>
        	
    </div>
</div>


<div id="tools">
    <div class="sp">        

        {% include 'shop/snippets/currency.html' %}
        <div id="userbasket" {% if basket_quantity > 0 %}class="selected"{% endif %}>
            <div id="item"></div>
    		<span class="basket"></span>
            
            <div id="quantity">
    	       {% blocktrans count basket_quantity as bq %}<span class="q">{{ bq }}</span> item{% plural %}<span class="q">{{ bq }}</span> items{% endblocktrans %} / {{ currency.symbol }}<span class="p">{{ basket_amount|floatformat:"2" }}</span>
    	       {% if basket_quantity > 0 %}{% endif %}
    	       {% if basket_quantity %}
    	       <a href="{% url basket %}" title="{% trans 'View your basket' %}" alt="{% trans 'View your basket' %}">{% trans 'Checkout now' %} &raquo;</a>
    	       {% endif %}
            </div>
        </div>
        
        <div id="tagline">
            
            <span class="red">SALE ON NOW!</span> 10% off all our Chinese teas for a short time only - <a href="{% url finder _('teas') %}">start browsing!</a>
            
            <!--
            {% url page _('about') as url %}
            {% blocktrans %}Fine Chinese teas, direct from farms in China - <a href="{{ url }}">find out more &raquo;</a>{% endblocktrans %}
            -->
        </div>

       <div class="hr"></div>

    </div>
</div>


<!-- end header -->

    <!-- EXCLUDED
    {% if landing_page %}
        {% include 'affiliate/campaign.html' %}
    {% endif %}
    -->

    
	{% block content %}{% endblock %}
	
	{% block footer %}
		{% include "shop/snippets/footer.html" %} 
	{% endblock %}


</div>

	{% block extrajs %}{% endblock %}
	<script type="text/javascript">

        function makeOverlay(HTML, width) {
            var overlay = jQuery('<div id="overlay" class="overlay" style="display:none"> </div>');
            overlay.appendTo(document.body);
            overlay.fadeIn(300);
            var overlayInner = jQuery('<div id="overlay-inner" class="overlay"></div>');
            if (width) {
               overlayInner.css({'width': width,}); 
            }
            
            
            
            
            overlayInner.appendTo(document.body);
            overlayInner.html(jQuery(HTML));
            overlayInner.append('<a href="#" class="close" style="color:#999;font-size:22px; font-weight:100;text-decoration:none;position:absolute; top: 7px; right: 10px;">x</a>');
            overlay.bind('click', removeOverlay);
            
            $('.close').bind('click', removeOverlay);
        }
               
        function removeOverlay() {
            $('.overlay, #overlay-inner').fadeOut(100);
            $('.overlay').remove();
        }       


		$(document).ready( function() {

			// clear input on focus
			var clearMePrevious = '';
			$('.clearMeFocus').each( function() {
				if ($(this).val() == '') {
				    var title = $(this).attr('title');
				    $(this).val(title);
				}
			});
			
			$('.clearMeFocus').focus(function()
			{
				if($(this).val()==$(this).attr('title'))
				{
					clearMePrevious = $(this).val();
					$(this).val('');
					$(this).css('color', '#333');
				}
			});
			
			// if field is empty afterward, add text again
			$('.clearMeFocus').blur(function()
			{
				if($(this).val()=='')
				{
					$(this).val(clearMePrevious);
					$(this).css('color', '#999');
				}
			});
		
            /// HANDLES THE CURRENCY ROLLDOWN
    		 $('#currency').hover(function() {
    		    $(this).animate({height: '50px',}, 150);
    		 }, function() {
    		    $(this).animate({height: '15px',}, 100);
    		 });
    		 
    		
    		/// MANAGES THE ADD-TO-CART BUTTONS 
    		$('a.addtocart').click( function() {
              var thisButton = $(this);
              
              makeOverlay('<img src="{{ static_url }}images/loading.gif" id="loading" />');
                         
              $.ajax({
              	url: thisButton.attr('href'),
            	type: "GET",
               	dataType: 'json',
               	success: function(data) {
               		
               		/// CREATE AN OVERLAY CONFIRMING THE BASKET WAS ADDED
               		var html = '';
               		
               		/// TRY TO FIND AN IMAGE
               		if ( thisButton.parents(".info.tea").find('.imagelink img').length ) {
               		   var productImgURL = thisButton.parents(".info.tea").find('.imagelink img').attr('src');
               		} else {
               		   var productImgURL = $('#image_wrap img').attr('src');
               		}
               		
               		
               		var html = '<div class="message">';
               		if (productImgURL) { 
                   		html += '<img src="'+ productImgURL+'" />';
               		}
               		html += data.message;
               		html += '<div class="buttons">';
               		html += '<a class="button green large" href="{% url basket %}">{% trans "Checkout now" %}</a><p>or <a class="close" onclick="removeOverlay();" href="#">continue browsing</a></p></div>';
               		$('#overlay-inner').append(html);
               		$('#loading').remove();
               		
               		
               		/// INCREMENT VALUES IN THE HEADER BASKET
                    if ($('#userbasket').hasClass('selected')) {} else {
                         $('#userbasket').addClass('selected'); 
                         $('#userbasket #quantity').append('<a href="{% url basket %}" title="{% trans 'View your basket' %}" alt="{% trans 'View your basket' %}">{% trans 'Checkout now' %} &raquo;</a>'); 
                    }
                    $('#quantity .p').text(parseFloat(data.basket_amount).toFixed(2));
                    $('#quantity .q').html(parseInt($('#quantity .q').html(), 10)+1);
               		
               	},
              });
              return false;
            });
		 
					
		});
		
		
	</script>

</body>

</html>
