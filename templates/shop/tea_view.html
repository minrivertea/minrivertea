{% extends base_template %}
{% load thumbnail django_static i18n %}

{% block metadescription %}{% if tea.meta_description %}{{ tea.meta_description|safe }}{% else %}{{ tea.name }} - {{ tea.description|safe }}{% endif %}{% endblock %}
{% block pagetitle %}{% if not tea.meta_title %}{{ tea.name }}{% else %}{{ tea.meta_title }}{% endif %}{% endblock %}

{% block canonical %}<link rel="canonical" href="http://www.minrivertea.com{{ tea.get_absolute_url }}" />{% endblock %}


{% block extrajs %}
<script>
$(function() {

$(".scrollable").scrollable();

$(".items img").click(function() {

	if ($(this).hasClass("active")) { return; }
	var url = $(this).attr("alt");
	var wrap = $("#image_wrap").fadeTo("medium", 0.2);

	var img = new Image();
    
	img.onload = function() {
		wrap.fadeTo("fast", 1);
		wrap.find("img").attr("src", url);	
	};

	img.src = url;

	$(".items img").removeClass("active");
	$(this).addClass("active");

}).filter(":first").click();
});

function addToBasket(idx) {
   $('a#add_to_basket_' + idx).click( function() {
   	  $('#price_' + idx).css('opacity', '0.5');
   	  $('#price_' + idx + ' .message').replaceWith('<div class="message"></div>').toggle();
   	  $('#price_' + idx + ' div.message').fadeIn(200);
   	  $.ajax({
   	      url: '/basket/add/' + idx,
   	      type: "GET",
   	      data: "xhr=true&id=" + idx,
   	      dataType: 'json',
   	      success: function(data){

    		$("#basket-number").replaceWith('<span id="basket-number">(' + data.quantity + ')</span>');
    		$('.description').css('opacity', '0.4').delay(3900).queue(function() {$(this).css('opacity', '1')});
            $('#price_' + idx + ' .message').append(data.item).delay(3800).fadeOut(1200);
            $('#price_' + idx).css('opacity', '1');
  		  }
   	  })
   	  return false;
   });	
}

$(document).ready( function() {
    addToBasket({{ price.id }});
    addToBasket({{ big_price.id }});
});


</script>
{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="{% staticfile '/css/teas.css' %}"/>
<style type="text/css">

#mtw #left {
  background: #fff;
  border: 10px solid #E1ECF3;
  padding: 55px 15px 15px;
  width: 910px;
  position: relative;   
}

#mtw #left h2 {
  background: #E1ECF3;
  padding: 10px;
  position: absolute;
  top: 0;
  left: 0;
  width: 930px; 
  font-family: Helvetica, Arial, sans-serif;  
  font-weight: bold;
  font-size: 24px;
  letter-spacing: -1px;
}

h1 {
  font-size: 40px;	
  margin-bottom: 10px;
}

h1 span {
  font-size: 30px;
  color: #999;
  margin-left: 10px;	
}

div.product-photos-small {
    float: left;
    margin: 0px 0 0px 15px;
    text-align: right;
    width: 60px;
}

.tea-top .left {
  float: left;
  width: 500px;
  margin-right: 30px;	
  height: auto;
}

.tea-top div.main-image div.product-photos-small img {
    float: left;
    margin: 0 0px 10px 0;
    opacity: 0.6;
}

.tea-top div.main-image div.product-photos-small img:last-child {
  margin-right: 0;	
}

.tea-top div.main-image div.product-photos-small img:hover {
  cursor: pointer;
  opacity: 0.8;	
  box-shadow: 0 1px 3px #999;
}

.tea-top div.main-image div.product-photos-small img.active {
  opacity: 1;	
}

div.product-photos-small p {
    float: left;
    font-size: 13px;
    line-height: 1.3em;
    margin-top: 20px;
    text-align: right;
    width: 100px;
}

.tea-top {
    float: left;
    margin: 10px 0 30px;
    padding-bottom: 10px;
}

.tea-top .description {
  width: 360px;
  float: right;	
}

.tea-top div.description p {
  font-size: 20px;
  color: #333;	
  margin: 0 0 10px 0;
  text-shadow: 2px 2px 0 #fff;
}

.tea-top div.description p.small {
  font-size: 16px;	
}

.tea-top div.main-image {
    float: left;
    margin-right: 20px;
    padding: 0px 10px 10px 0;
    width: 600px;
}

.tea-top div#prices {
    float: right;
    width: 360px;
    margin: 15px 0 0;
}

.price {
    float: left;
    margin: 0;
    position: relative;
    width: 360px;
}

.price.big {
  float: left;
  margin: 10px 0 0 0; 
  width: 225px;  
}

a.button {
    float: right;
    font-size: 18px;
    margin: 0;
    position: relative;
    width: 150px;
    top: -5px;
    padding: 11px 20px 9px;
}

.price.big a.button {
   float: left;
}



.tea-top div.tea-description {
  float: left;
  width: 330px;
  margin-top: 0px;
  margin-bottom: 0px;
}

div.price-text {
    color: #EE6464;
    float: left;
    font-size: 28px;
    font-weight: bold;
    height: 23px;
    letter-spacing: -1px;
    margin: 0;
    position: relative;
    top: -4px;
    width: 200px;
}

div.message {
    background-color: #FFFFFF;
    border: 1px solid #C1C1C1;
    border-radius: 5px 5px 5px 5px;
    display: none;
    height: auto;
    padding: 15px;
    position: absolute;
    right: 0;
    top: -135px;
    width: 260px;
    z-index: 10;
}

div.message:after {
        content: " ";
        display: block;
        width: 0;
        height: 0;
        border-top: 15px solid #d1d1d1;         
        border-bottom: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        position: absolute;
        bottom: -15px;
        right: 25px;
        z-index: 1;
        margin-left: ;
}

.message:before {
        content: " ";
        display: block;
        width: 0;
        height: 0;
        border-top: 15px solid #fff;     
        border-bottom: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        position: absolute;
        bottom: -14px;
        right: 25px;
        z-index: 2;
        margin-left: -1px;
}

div.message p {
  margin: 0;
  font-size: 15px;
  font-family: Helvetica, Arial, sans-serif;
  line-height: 1.2em;
}

div.message p a {
  font-size: 20px;
  line-height: 1em;	
  color: #f37679;
  font-family: Helvetica, Arial, sans-serif;
}

div.message p span.tick {
  color: #237A2A;
  font-size: 30px;   
}

div.message p a:hover {
  text-decoration: underline;	
}

div.message img {
  float: left;
  margin-right: 5px;
  margin-bottom: 15px;	
}

table.details {
    margin-top: 10px;
}

table.details tr {
  padding-bottom: 10px;	
}

table.details td {
  padding: 15px;	
  background-color: #fff;
}

table.details td a {
  font-size: 12px;	
}

table.details td.left {
  padding-right: 10px;
  background-color: #E1ECF3;
  font-family: Helvetica, Arial, sans-serif;
  font-size: 14px;
}

span.name {
  font-family: Helvetica, sans-serif;
  font-weight: bold;
  font-size: 14px;   
}

.amount {
    color: #237A2A;
    float: left;
    font-family: Helvetica,Arial,sans-serif;
    font-size: 30px;
    font-weight: bold;
    letter-spacing: -4px;
    line-height: 1em;
    margin: 0 0 10px;
    position: relative;
    text-shadow: 1px 1px 0 #FFFFFF;
}

.price.big .amount {
   font-size: 35px;
   margin: 5px 0 15px;   
}

.price-description {
    color: #555555;
    float: left;
    font-family: Helvetica,Arial,sans-serif;
    font-size: 12px;
    left: 5px;
    line-height: 1em;
    margin: 0 0 0 5px;
    position: relative;
    width: 100px;
}

.price-description span {
  color: #666;
}

.price.big .price-description {
  margin: 5px 0 15px 10px;
     
}


div.fb-recommend {
  margin-top: 20px;
  float: left;	
}

#facebook, #google {
  float: left;
  width: 80px;
}

#google {
  margin-bottom: 10px;
}

.loading {
    left: 240px;
    position: absolute;
    top: 160px;
    z-index: -1;
}

#extras {
  width: 100%;
  float:left;
  margin-bottom: 30px; 
  display:none;  
}

#extras .info {
  margin: 0 15px 20px 0;   
  height: 160px;
  width: 240px;
  background: #fff;
  border: 10px solid #E1ECF3;
}

#recommended {
  float: left;
  width: 100%;
  margin: 30px 0 0 0;   
}

#recommended h3 {
  font-size: 24px;
  font-family: Helvetica, Arial, sans-serif;
  font-weight:bold;  
  margin: 0 0 20px 0; 
  color: #FF6569;
}

#recommended .info {
  margin: 0 15px 20px 0;   
  height: 235px;
  width: 225px;
  background: #fff;
  border: 10px solid #E1ECF3;
}

#recommended .info.trans {
  margin: 0 15px 19px 0;
  padding: 0px;   
  width: auto;
  height: 160px;
  border-color: #fff;
}

#recommended .info h3 {
  position: absolute;
  bottom: -5px;
  left: 0px;  
  width: 210px;
  padding: 10px 10px 5px 20px;
  background: #fff; 
  text-align: right;
  color: #6a9bba;
  font-size: 13px;
  margin: 0;
}


#extras .info.long {
  width: 515px; 
  overflow: hidden;  
}

#extras .info.trans, #extras .info.map {
  margin: 0 0px 19px 0;
  padding: 0px;   
  width: auto;
  height: 265px;
  border-color: #fff;
}

#extras .info.trans:hover, #extras .info.map:hover {
  box-shadow: 0 1px 3px #e1e1e1;   
}

#extras .info.trans:hover h3 a, #extras .info.map:hover h3 a {
  text-decoration: underline;
  color: #FF6569;   
}

#extras .info.map {
  margin: 0 15px 20px 0; 
  width: 255px;  
}

#extras .info h3 {
  position: absolute;
  bottom: -5px;
  left: 0px;  
  width: 235px;
  padding: 10px 10px 0px 20px;
  background: #E1ECF3; 
  text-align: right;
  color: #6a9bba;
}

#extras .info.trans h3 {
   width: 340px; 
   background: #fff;  
}

#extras .info.map h3 {
  background-color: #fff;   
}

#extras .info.long h3 {
   width: 520px;   
}

#image_wrap {
    display: block;
    height: 331px;
    width: 500px;
    float: left;
}   

#recommended {
  float: left;
  width: 100%;   
}


#long-description, #brew {
  float: left;
  width: 300px;  
  margin: 0 30px 0 0; 
}

#long-description p, #brew p, #map p {
  font-size: 13px; 
  margin: 0 0 20px 0;  
}

#long-description h3, #brew h3 {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 14px;
  font-weight: bold;   
}

#map {
  float: left;
  width: 255px;
  margin: 0 30px 0 0;
  position: relative;  
} 

#map img {
  float: left;
  margin: 0 0 15px 0;   
}

#map h3 {
  font-family: Helvetica, sans-serif;
  font-size: 14px;
  font-weight: bold;   
}

#shipping {
  width: 300px; 
  background: transparent;
  border: none;
  padding: 0;
  margin: 10px 0 0 0;  
}

#shipping img {
  float: left; 
  margin: 0 0 25px 0;  
}

#shipping #shipping-amount {
    color: #999999;
    float: left;
    font-size: 40px;
    left: 12px;
    line-height: 1em;
    padding: 0;
    position: relative;
    text-shadow: 1px 1px 0 #FFFFFF;
    top: -2px;
}


</style>
{% endblock %}


{% block currency %}
	{% include 'shop/snippets/currency.html' %}
{% endblock %}


{% block content %}


{% if tea.category.parent_category.slug == 'teas' %}
    {% include 'shop/snippets/teas_sub_nav.html' %}
{% endif %}


<div id="mtw">
  <div class="sp">
		
	<h1>{% if tea.long_name %}{{ tea.long_name|safe }}{% else %}{{ tea.name }}{% endif %}</h1>

	<div class="tea-top">
		<div class="left">
		<div class="main-image">
			<img class="loading" src="{% staticfile '/images/loading.gif' %}"/>
			<div id="image_wrap">	
				<img src="http://static.flowplayer.org/tools/img/blank.gif" width="500x331" height="auto" /> 
			</div>
		
		    <div class="product-photos-small">
			<div class="scrollable">   
			   <div class="items">
  			    <div>
  			        {% thumbnail tea.image thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.description }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					
					{% if tea.image_2 %}
  			    	{% thumbnail tea.image_2 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_2 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_2_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_3 %}
					{% thumbnail tea.image_3 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_3 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_3_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_4 %}
					{% thumbnail tea.image_4 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_4 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_4_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_5 %}
					{% thumbnail tea.image_5 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_5 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_5_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
      			</div>
      		  </div>
      		</div>
		</div><!-- end product photos small -->
		</div><!-- end main image div -->
		</div>
		
		<div class="description">{{ tea.body_text|safe }}</div>
		
		<div id="prices">
	 	{% if tea.is_active %}
		      <div id="price_{{ price.id }}" class="price">
		      	<div class="message"></div>
		    	<span class="amount">{{ currency.symbol }}{{ price.price|floatformat:"-2" }}</span> 
		    	     <span class="price-description">/ {% if price.weight %}{{ price.weight }}{{ price.weight_unit }}{% else %}{{ price.description }}{% endif %}<br/>
		    	</span>
				<a title="{% trans 'Add 1 x ' %} {{ tea.name }} ({{ price.weight|floatformat }}{{ price.weight_unit }}) to your basket" href="{% url add_to_basket price.id %}" class="button green" id="add_to_basket_{{ price.id }}">{% trans 'Add 1 to basket' %} +</a>
              </div>

		      <div id="price-helper"> 
		        {% if tea.stocks.count > 0 %}
		          <div class="stocks"><strong>{{ tea.stocks.count }}</strong> in stock</div>
		          <div class="postage-cost"><strong>{{ currency.symbol }}{{ currency.postage_cost }}</strong> shipping, free over <strong>{{ currency.symbol }}{{ currency.postage_discount_threshold }}</strong></div>       
        	    {% else %}
       	          <span class="not-in-stock">{% trans 'Pre-order now and get this on' %} <strong>{{ tea.get_preorder_date|date:"d M Y" }}</strong></span>
        	      <br/>{% trans "We're restocking, so delivery will take longer than usual." %}</a>
			   {% endif %}
		      </div>

		      
		      
		      
		      
		{% else %}
    		  <div id="price-helper">        
            	<span class="not-in-stock">{% trans 'This tea is not currently available for sale.' %}</span>
    		  </div>	
		{% endif %}
		
		</div>
		

	</div><!-- end top product info div -->
	
	
	
	<div id="extras">
	   {% if tea.extra_info %}
	   <div class="info">
	       {% if big_price %}
	           <h2>{% trans 'Prefer to buy big?' %}</h2>
	           <p>{% blocktrans with tea.name as name %}If you’re fanatical about tea, save some cash and buy 500g of <strong>{{ name }}</strong> with free postage + 10% saving.{% endblocktrans %}</p>
	           <div id="price_{{ big_price.id }}" class="price big">
	               <div class="message"></div>
	               <span class="amount">{{ big_price.currency.symbol }}{{ big_price.price|floatformat:"-2" }}</span>
	               <span class="price-description">/ {{ big_price.weight }}{{ big_price.weight_unit }}</span><br clear="all"/>
	               <a href="{% url add_to_basket big_price.id %}" class="button green big" id="add_to_basket_{{ big_price.id }}">{% trans 'Add to basket' %}</a>
	           </div>
	           
	       {% else %}
                {{ tea.extra_info|safe }}
           {% endif %}
		</div>
		{% endif %}
		
		
		{% if tea.map_image %}
    	   <div class="info map">  
    	      <a href="{{ tea.map_page.get_absolute_url }}"><span class="link"></span></a>
    	      {% thumbnail tea.map_image "255x237" crop="center" as im %}
    	          <img src="{{ im.url }}"/>
    	      {% endthumbnail %}
    	      <h3><a href="{{ tea.map_page.get_absolute_url }}">{% blocktrans with tea.map_location as map and tea.name as name %}Our {{ name }} tea is grown in {{ map }}{% endblocktrans %}</a></h3>
    	   </div>
	   {% else %}
		  <div class="info">
                <h3>{% trans 'Worldwide shipping' %}</h3>
                <p>{% blocktrans with currency.symbol as symbol and currency.postage_cost as pc and currency.postage_discount_threshold as pdt %}We ship anywhere in the world. Orders are shipped from our storage facility in the UK for a flat fee of {{ symbol }}{{ pc }} regardless of how many items you order. If you order more than {{ symbol }}{{ pdt }} then it's free!{% endblocktrans %}</p>		  
		  </div>
	   {% endif %}
		
		
		
		{% for t in tea.recommended.all %}
		 {% if forloop.counter == 1 %}
		  <div class="info trans">
		      <a href="{{ t.get_absolute_url }}"><span class="link"></span></a>
		      {% thumbnail t.image "360x260" crop="center" as im %}
		      <img src="{{ im.url }}"/>
		      {% endthumbnail %}
		      <h3><a href="{{ t.get_absolute_url }}">{{ t.name }} {% trans 'from' %} {{ currency.symbol }}{{ t.get_lowest_price.price|floatformat }} &raquo;</a></h3>
		  </div>
		  {% endif %}
		{% endfor %}



        {% if review %}
    	   <div class="info long">
    		  <h3>{% trans 'Our customers say…' %}</h3>
		      <p>&ldquo;{{ review.short_text }}&rdquo;<br/> <span class="name">{{ review.first_name }} {% if review.url %}from <a href="{{ review.url }}">{{ review.show_url }}</a>{% else %}{% if review.last_name %}{{ review.last_name }}{% endif %}{% endif %} - <a href="{% url reviews %}">{% trans 'read more reviews' %} &raquo;</a></span><br/>
		      </p>
		      {% if big_price %}
		      <br/>
		      <p> 
		          {{ tea.extra_info|safe }}
		      </p>
		      {% endif %}
            </div>    
        {% endif %}

		{% for t in tea.recommended.all %}
		 {% if forloop.counter == 2 %}
		  <div class="info trans">
		      <a href="{{ t.get_absolute_url }}"><span class="link"></span></a>
		      {% thumbnail t.image "360x260" crop="center" as im %}
		      <img src="{{ im.url }}"/>
		      {% endthumbnail %}
		      <h3><a href="{{ t.get_absolute_url }}">{{ t.name }} {% trans 'from' %} {{ currency.symbol }}{{ t.get_lowest_price.price|floatformat }} &raquo;</a></h3>
		  </div>
		  {% endif %}
		{% endfor %}
	</div>
	
	
	{% if tea.map_image %}
    <div id="map">  
          {% thumbnail tea.map_image "255x120" crop="center" as im %}
              <img src="{{ im.url }}"/>
          {% endthumbnail %}
          <p>{{ tea.map_caption }}</p>
          
          {% thumbnail tea.farm_image "255x120" crop="center" as im %}
              <img src="{{ im.url }}"/>
          {% endthumbnail %}
          <p>{{ tea.farm_caption }}</p>
    </div>
	{% endif  %}
	
	<div id="long-description">
	   <h3>More about this tea</h3>
	   {{ tea.long_description|safe }}
	</div>
	
	<div id="brew">
	   {{ tea.extra_info|safe }}
	</div>
	
	<div id="shipping" class="info">
	   <img src="{% staticfile '/images/free-delivery.png' %}"/>
	   <span id="shipping-amount">{{ currency.symbol }}{{ currency.postage_discount_threshold }}</span>
	</div>
	
	
	<br clear="all"/>
	
	
	
	<div id="recommended">
	   <h3>Also recommended...</h3>
	   {% for x in recommended %}
		  <div class="info trans">
		      <a href="{{ x.get_absolute_url }}"><span class="link"></span></a>
		      {% thumbnail x.image thumb_medium crop="center" as im %}
		      <img src="{{ im.url }}"/>
		      {% endthumbnail %}
		      <h3><a href="{{ x.get_absolute_url }}">{{ x.name }} {% trans 'from' %} {{ currency.symbol }}{{ x.get_lowest_price.price|floatformat }} &raquo;</a></h3>
		  </div>
	   {% endfor %}
	</div>

	
	{% if region == 'China' %}
	{% else %}
	{% if ga_is_on %}
    <ul class="rss">
		<li id="google">
			<g:plusone></g:plusone>
			<script type="text/javascript">
			  (function() {
			    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
			    po.src = 'https://apis.google.com/js/plusone.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			  })();
			</script>
		</li>
    	<li id="facebook">
		    <div id="fb-root"></div>
		    <script src="http://connect.facebook.net/en_US/all.js#appId=234100573279411&amp;xfbml=1"></script>
		    <fb:like href="http://www.minrivertea.com/teas/{{ tea.slug }}" send="false" layout="button_count" width="80" show_faces="true" font="">
		    </fb:like>
		</li>
	</ul>
	{% endif %}
	{% endif %}


</div>
</div>
{% endblock %}
