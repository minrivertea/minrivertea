{% extends base_template %}
{% load thumbnail i18n convert_weights %}

{% block metadescription %}{% if tea.meta_description %}{{ tea.meta_description|safe }}{% else %}{{ tea.name }} - {{ tea.description|safe }}{% endif %}{% endblock %}

{% block pagetitle %}{% if not tea.meta_title %}{{ tea.name }}{% else %}{{ tea.meta_title }}{% endif %}{% endblock %}

{% block canonical %}<link rel="canonical" href="http://www.minrivertea.com{{ tea.get_absolute_url }}" />{% endblock %}

{% block extrajs %}
<script>
$(function() {

$(".scrollable").scrollable();

$(".items img").click(function() {

	if ($(this).hasClass("active")) { return; }
	var url = $(this).attr("alt");
	var wrap = $("#image_wrap").fadeTo("medium", 0.2);

	var img = new Image();
    
	img.onload = function() {
		wrap.fadeTo("fast", 1);
		wrap.find("img").attr("src", url);	
	};

	img.src = url;

	$(".items img").removeClass("active");
	$(this).addClass("active");

}).filter(":first").click();
});

function addToBasket(idx) {
   $(idx).click( function() {
   	  
      $('#messages').slideDown(100);
   	  $.ajax({
   	      url: $(this).attr('href'),
   	      type: "GET",
   	      dataType: 'json',
   	      success: function(data){
            
            /// increment the values in the header basket
            if ($('#userbasket').hasClass('selected')) {} else {
                 $('#userbasket').addClass('selected'); 
                 $('#userbasket #quantity').append('<br/><a href="{% url basket %}" title="{% trans 'View your basket' %}" alt="{% trans 'View your basket' %}">{% trans 'Checkout now' %} &raquo;</a>'); 
            }
            $('#quantity .p').text(parseFloat(data.basket_quantity).toFixed(2));
            $('#quantity .q').html(parseInt($('#quantity .q').html(), 10)+1);
    		
    		/// add the message
    		if ($('#messages .message').length) {
    		    $('#messages .message .num').html(parseInt($('#messages .message .num').html(), 10)+1);
   		        $('#messages .message .num').addClass('active');
    		} else {    		
        		$('#messages .sp').append('<div class="message"><img src="{{ static_url }}images/loading.gif" /></div>');
        		$('#messages .message img:visible').remove();
        		$('#messages .message').append(data.message).delay(5900).queue(function() {
        		      $(this).css('opacity', '1');
        		      $('#messages').slideUp(200);
        		      $('#messages .message').remove();
        		});
    		}
  		  }
   	  })
   	  return false;
   });	
}

$(document).ready( function() {
    addToBasket('#add_normal');
    addToBasket('#monthly_add');
});


</script>
{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="{{ static_url }}css/teas.css"/>
<style type="text/css">

#mtw #left {
  background: #fff;
  border: 10px solid #E1ECF3;
  padding: 55px 15px 15px;
  width: 910px;
  position: relative;   
}

#mtw #left h2 {
  background: #E1ECF3;
  padding: 10px;
  position: absolute;
  top: 0;
  left: 0;
  width: 930px; 
  font-family: Helvetica, Arial, sans-serif;  
  font-weight: bold;
  font-size: 24px;
  letter-spacing: -1px;
}

h1 {
  font-size: 40px;	
  margin-bottom: 0px;
}

h1 span {
  font-size: 30px;
  color: #999;
  margin-left: 10px;	
}

div.product-photos-small {
    float: left;
    margin: 15px 0 0px;
    text-align: right;
    width: 500px;
}

.tea-top div.main-image div.product-photos-small img {
    float: left;
    margin: 0 5px 0px 0;
    opacity: 0.6;
}

.tea-top div.main-image div.product-photos-small img:last-child {
  margin-right: 0;	
}

.tea-top div.main-image div.product-photos-small img:hover {
  cursor: pointer;
  opacity: 0.8;	
  box-shadow: 0 1px 3px #999;
}

.tea-top div.main-image div.product-photos-small img.active {
  opacity: 1;	
}

div.product-photos-small p {
    float: left;
    font-size: 13px;
    line-height: 1.3em;
    margin-top: 20px;
    text-align: right;
    width: 100px;
}

.tea-top {
    background: none repeat scroll 0 0 #FFFFFF;
    border-radius: 8px 8px 8px 8px;
    float: left;
    margin: 20px 0 40px;
    padding: 15px;
}

.tea-top .left {
  width: 500px;
  float: left;   
}


.tea-top .description {
  width: 400px;
  float: right;	
}

.tea-top div.description p {
  font-size: 22px;
  color: #333;	
  margin: 0 0 10px 0;
  text-shadow: 2px 2px 0 #fff;
}

.tea-top div.description p.small {
  font-size: 16px;	
}

.tea-top div.main-image {
    float: left;
    width: 500px;
}

.tea-top div#prices {
    float: right;
    width: 400px;
    margin: 15px 0 0;
}

.tea-top .price {
    float: left;
    margin: 0 0 10px;
    position: relative;
    width: 100%;
}

.tea-top #original {
  float: left;
  width: 360px;
  font-family: Helvetica,Arial,sans-serif;
  font-size: 13px; 
  margin: 0 0 30px 0;
}

.tea-top #original span {
    background: none repeat scroll 0 0 red;
    border-radius: 5px 5px 5px 5px;
    color: #FFFFFF;
    font-weight: bold;
    letter-spacing: -0.5px;
    padding: 5px 10px;
    text-decoration: normal;
    text-shadow: 0 1px 1px #555;
}

.price.big {
  float: left;
  margin: 10px 0 0 0; 
  width: 225px;  
}

a.button {
    float: right;
    font-size: 18px;
    margin: 0;
    position: relative;
    width: 170px;
    padding: 11px 20px 9px;
    text-align: right;
}

.price.big a.button {
   float: left;
}



.tea-top div.tea-description {
  float: left;
  width: 330px;
  margin-top: 0px;
  margin-bottom: 0px;
}

div.price-text {
    color: #EE6464;
    float: left;
    font-size: 28px;
    font-weight: bold;
    height: 23px;
    letter-spacing: -1px;
    margin: 0;
    position: relative;
    top: -4px;
    width: 200px;
}

#stocks {
  float: left;
  width: 100%;
  padding: 15px 0 0 0;
  border-top: 1px solid #e1e1e1; 
  font-family: Helvetica, arial, sans-serif;
  font-size: 13px;
  text-align: right;  
}

#stocks div {
  float: left;
  width: auto;
  text-align: center;
  padding: 0 10px;
  color: #555; 
  border-right: 1px solid #e1e1e1;   
}

#stocks div:last-child {
  border-right: none;   
}

#stocks div strong {
  color: #32607d;   
}

table.details {
    margin-top: 10px;
}

table.details tr {
  padding-bottom: 10px;	
}

table.details td {
  padding: 15px;	
  background-color: #fff;
}

table.details td a {
  font-size: 12px;	
}

table.details td.left {
  padding-right: 10px;
  background-color: #E1ECF3;
  font-family: Helvetica, Arial, sans-serif;
  font-size: 14px;
}

span.name {
  font-family: Helvetica, sans-serif;
  font-weight: bold;
  font-size: 14px;   
}

#prices .amount {
    color: #237A2A;
    float: right;
    font-family: Helvetica,Arial,sans-serif;
    font-size: 40px;
    font-weight: bold;
    letter-spacing: -2.5px;
    line-height: 1em;
    margin: 0 10px 10px;
    position: relative;
    text-shadow: 1px 1px 0 #FFFFFF;
}

.price.big .amount {
   font-size: 35px;
   margin: 5px 0 15px;   
}

.price-description {
    color: #777777;
    float: right;
    font-family: Helvetica,Arial,sans-serif;
    font-size: 14px;
    margin: 0;
    position: relative;
    width: auto;
    max-width: 110px;
}

.price-description span {
  color: #666;
}

.price.big .price-description {
  margin: 5px 0 15px 10px;
     
}


div.fb-recommend {
  margin-top: 20px;
  float: left;	
}

#facebook, #google {
  float: left;
  width: 80px;
}

.loading {
    left: 240px;
    position: absolute;
    top: 160px;
    z-index: -1;
}

#recommended, #reviews {
  float: left;
  width: 100%;
  margin: 0px 0 0 0;   
}

#reviews {
  background: #fff;
  padding: 2%;
  width: 96%;
  margin: 10px 0 10px;
  position: relative;  
}

#reviews .sp {
  height: 180px;   
}

#recommended h3.title, #reviews h3 {
    color: #5F829A;
    font-size: 22px;
    margin: 0 0 10px;
}

#reviews a.add-review {
  position: absolute;
  bottom: -10px;
  right: 50px;   
}


#reviews ul {
  list-style-type: none;
  padding: 0;
  margin: 0;   
}

#reviews ul li {
  float: left;
  width: 290px;
  margin: 0 30px 0px 0;
  font-size: 14px;
  letter-spacing: -0.2px;
}

#reviews ul li strong {
  font-family: Helvetica, Arial, sans-serif; 
}

#image_wrap {
    display: block;
    height: 331px;
    width: 500px;
    float: left;
}

#description, #brewing {
  background: none;
  padding: 0;
  width: 300px;  
  margin: 0 30px 0 0; 
}

#brewing {
  margin-right: 0;
  width: 345px;   
}

#description p, #brewing p, #map p {
  margin: 0 0 20px 0;
  font-size: 14px;  
}

#description h3, #brewing h3 {
    color: #5F829A;
    font-size: 22px;
    font-weight: normal;
    font-family: "Times New Roman", Georgia, serif;
}

#extras {
  float: left;
  width: 100%;   
}

#extras .box {
  float: right;
  width: 345px;   
}

#extras .info {
  float: left;   
}

#map {
  background: none;
  padding: 0;
  width: 255px;
  margin: 0 30px 0 0;
  position: relative;  
} 

#map img {
  float: left;
  margin: 0 0 15px 0;   
}

#map p {
  font-style: italic;   
}

#shipping.info, #safe.info {
  width: 325px;
  float: right;
  padding: 10px;
  margin: 10px 0 0 0;  
}

#shipping img, #safe img {
  margin: 0;   
}

#shipping p, #safe p {
  font-weight: bold;
  font-family: Helvetica, Arial, sans-serif;
  font-size: 12px;
  color: #777; 
  padding-left: 10px;  
}

#monthly {
    background: none repeat scroll 0 0 transparent;
    border-bottom: 3px dotted #E1E1E1;
    float: left;
    height: auto;
    margin: 30px 0 40px;
    padding: 0px 0 20px;
    width: 100%;
}

{% if not reviews %}
#monthly {
  padding-top: 30px;
  border-top: 3px dotted #e1e1e1;   
}
{% endif %}

#monthly img.teabox {
    float: left;
    margin: 0 0px 0 0;
    position: relative;
    top: -5px;
}

#monthly .button {
    float: right;
    font-size: 18px;
    margin: 10px 0 5px;
    padding: 8px 15px;
    text-align: center;
    top: 0;
}

#monthly h3 {
    background: none repeat scroll 0 0 #59849F;
    border-radius: 5px 0 0 5px;
    color: #FFFFFF;
    float: left;
    font-family: Helvetica,Arial,sans-serif;
    font-size: 28px;
    font-weight: bold;
    height: 45px;
    letter-spacing: -1.5px;
    margin: 0 40px 0 0;
    padding: 20px 0 0;
    position: relative;
    text-align: center;
    text-shadow: 0 1px 1px #333333;
    width: 120px;
}

#monthly h3:before {
    border-color: transparent -moz-use-text-color transparent #59849F;
    border-style: solid none solid solid;
    border-width: 33px 0 33px 19px;
    content: " ";
    display: block;
    position: absolute;
    right: -19px;
    top: 0;
}

#monthly div {
    display: block;
    float: left;
    font-size: 14px;
    margin: 0 10px 0 0;
    padding: 0;
    width: 280px;
    line-height: 1.6em;
    letter-spacing: -0.2px;
}

#monthly div span {
  font-size: 17px;
  font-family: Helvetica, Arial, sans-serif;   
  font-weight: bold;
  letter-spacing: -0.5px;
}

#monthly div.price {
    float: right;
    margin: 0;
    padding-top: 0px;
    text-align: right;
    width: 350px;
}

#monthly div.price span {
  float: left;
  width: 120px;
  text-align: center;
}

#monthly div.price a.add-more {
  font-size: 13px;
  float: right;
  margin: 0;
}

#monthly div.price span.grey {
    color: #555555;
    font-size: 15px;
    font-weight: normal;
    float: left;
}

#monthly div.price span.amount {
  float: left; 
  color: #237A2A;
  font-size: 34px;
  padding-top: 15px;  
}

{% if reviews %}
ul.rss { 
  top: 10px;   
}
{% endif %}


</style>
{% endblock %}


{% block currency %}
	{% include 'shop/snippets/currency.html' %}
{% endblock %}


{% block content %}


{% if tea.category.parent_category.slug == 'teas' %}
    {% include 'shop/snippets/teas_sub_nav.html' %}
{% endif %}


<div id="mtw">
  <div class="sp">
		
	<h1>{% if tea.long_name %}{{ tea.long_name|safe }}{% else %}{{ tea.name }}{% endif %}</h1>

	<div class="tea-top">
		<div class="left">
		<div class="main-image">
			<img class="loading" src="{{ static_url }}images/loading.gif"/>
			<div id="image_wrap">	
				<img src="{{ static_url }}images/blank.gif" width="500px" height="331px" /> 
			</div>
		
		    <div class="product-photos-small">
			<div class="scrollable">   
			   <div class="items">
  			    <div>
  			        {% thumbnail tea.image thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.description }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					
					{% if tea.image_2 %}
  			    	{% thumbnail tea.image_2 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_2 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_2_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_3 %}
					{% thumbnail tea.image_3 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_3 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_3_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_4 %}
					{% thumbnail tea.image_4 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_4 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_4_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_5 %}
					{% thumbnail tea.image_5 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_5 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_5_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
      			</div>
      		  </div>
      		</div>
		</div><!-- end product photos small -->
		</div><!-- end main image div -->
		</div>
		
		<div class="description">{{ tea.body_text|safe }}</div>
		
		<div id="prices">
	 	{% if tea.is_active %}
		      <div id="price_{{ price.id }}" class="price">
		      	{% if price.is_sale_price %}
		      	   <div id="original"><span>On Sale Now!</span> Was <strong>{{ currency.symbol }}{{ price.old_price|floatformat:"-2" }}</strong>, save <strong>{{ currency.symbol }}{{ price.get_saving }}</strong></div>
		      	{% endif %}
		    	<span class="price-description">/ {% if price.weight %}{% convert_weights request price.weight %}{{ weight_unit }}{% else %}{{ price.description }}{% endif %}</span>
		    	<span class="amount">{{ currency.symbol }}{{ price.price|floatformat:"-2" }}</span> 

		    	<br clear="all"/>
				<a title="{% trans 'Add 1 x ' %} {{ tea.name }} {% if price.weight %}({% convert_weights request price.weight %}{{ weight_unit }}){% endif %} to your basket" href="{% url add_to_basket price.id %}" class="button green" id="add_normal"><span class="basket"></span>{% trans 'Add 1 to basket' %}</a>
              </div>

		      <div id="stocks"> 
		        {% if price.stocks.count > 0 %}
		          <div class="stocks">{% blocktrans with price.stocks.count as tsc %}<strong>{{ tsc }}</strong> in stock{% endblocktrans %}</div>
		          <div class="postage-cost">{% blocktrans with currency.symbol as sym and currency.postage_cost as pc and currency.postage_discount_threshold as pdt %}<strong>{{ sym }}{{ pc }}</strong> shipping, free over <strong>{{ sym }}{{ pdt }}</strong>{% endblocktrans %}</div>       
        	    {% else %}
       	          <span class="not-in-stock">{% trans 'Order now and get this on' %} <strong>{{ tea.get_preorder_date|date:"d M Y" }}</strong></span>
        	      <br/>{% trans "We're restocking, so delivery will take longer than usual." %}</a>
			   {% endif %}
		      </div>


		{% else %}
    		  <div id="stocks">        
            	<span class="not-in-stock">{% trans 'This tea is not currently available for sale.' %}</span>
    		  </div>	
		{% endif %}
		
		</div>
	</div><!-- end top product info div -->	
	
	
	<!-- START EXTRAS -->
	<div id="extras">
	{% if tea.map_image %}
    <div id="map" class="info">  
              {% thumbnail tea.map_image "255x120" crop="center" as im %}
                <img src="{{ im.url }}"/>
              {% endthumbnail %}
              {% if tea.map_caption %}<p>{{ tea.map_caption|safe }}</p>{% endif %}
                    
          {% if tea.farm_image %}
              {% thumbnail tea.farm_image "255x120" crop="center" as im %}
                  <img src="{{ im.url }}"/>
              {% endthumbnail %}
              {% if tea.farm_caption %}<p>{{ tea.farm_caption|safe }}</p>{% endif %}
          {% endif %}
    </div>
	{% endif  %}
	
	{% if tea.long_description %}
	<div id="description" class="info">
	   <h3>{% trans 'More about this product' %}</h3>
	   {{ tea.long_description|safe }}
	</div>
	{% endif %}
	
	{% if tea.extra_info %}
	<div id="brewing" class="info">
	   {{ tea.extra_info|safe }}
	</div>
	{% endif %}
	
	{% if tea.extra_info or tea.long_description or tea.map_image %}
	<div class="box">
	<div id="safe" class="info">
	   <img src="{{ static_url }}images/005.jpg"/>
	   {% url page _('terms-and-conditions') as tcurl %}
	   {% url page _('returns') as rturl %}
	   <p>{% blocktrans %}Read our <a href="{{ tcurl }}">T&Cs</a> and <a href="{{ rturl }}">Returns</a> policies{% endblocktrans %}</p>
	</div>
	
	<div id="shipping" class="info">
	   <img src="{{ static_url }}images/free-delivery.jpg" />
	   {% url page _('shipping') as shipurl %}
	   <p>{% blocktrans with currency.symbol as symbol and currency.postage_discount_threshold|floatformat:"-2" as ptd %}Orders over {{ symbol }}{{ ptd }} get free worldwide shipping.<br/>
	   Read more info about <a href="{{ shipurl }}">shipping</a>{% endblocktrans %}
	   </p>
	</div>
	</div>
	{% endif %}
	</div>
	<!-- END EXTRAS -->
	<br clear="all"/>	

    {% if reviews %}
    </div>
    <div id="reviews">
        <div class="sp">
       <h3>{% blocktrans %}What do customers say about {{ tea }}?{% endblocktrans %}</h3>
       <a class="add-review" href="{% url review_tea tea.category.slug tea.slug %}">{% trans 'Add your own review of this tea' %} &raquo;</a>
           <ul>
           {% for r in reviews %}
               <li>
                   &ldquo;{{ r.short_text }}&rdquo;<br/>
                   <strong>{{ r.first_name }} {{ r.last_name }}</strong>{% if r.url %} (<a href="{{ r.url }}">view original</a>){% endif %}
               </li>
           {% endfor %}
            </ul>
            
        </div>
    </div>
    <div class="sp">
    {% endif %}

{% if request.user.is_superuser %}
   {% if monthly_price %}
   <div id="monthly">
	   <h3>
	       {% trans 'TeaBox' %}<br/>
	   </h3>
	   <div class="months">
	       {% blocktrans with price.weight as weight and price.weight_unit as weight_unit and tea.name as tea_name %}
	       <span>Start a monthly TeaBox!</span><br/>
	       Save time and money with a monthly delivery of {{ tea_name }} direct to your home or office.
	       {% endblocktrans %}
	   </div>
	   <img class="teabox" src="{{ static_url }}images/homepage/home-monthly2.jpg"/>
	   <div class="price">
	           <span>
	               <span class="amount">{{ currency.symbol }}{{ monthly_price|floatformat:"-2" }}</span>
	               <span class="grey">{% convert_weights request price.weight %}{{ weight_unit }} / {% trans '6 months' %} </span> 
	           </span>    
	       <a href="{% url add_to_basket_monthly price.id 6 %}" id="monthly_add" class="button green">{% trans 'Add to your TeaBox' %}</a><br/>
	       <a href="{% url monthly_tea_box %}" class="add-more">{% trans 'Add more teas to your TeaBox' %} &raquo;</a>
	   </div>
  </div>
  {% endif %}
{% endif %}
	
	
	<div id="recommended">
	   <h3 class="title">{% trans 'Also recommended...' %}</h3>
	   {% for t in recommended %}
            {% include 'shop/snippets/product_small.html' %}		  
	   {% endfor %}
	</div>

    {% if ga_is_on %}
    <ul class="rss">
		<li id="google">
			<g:plusone></g:plusone>
			<script type="text/javascript">
			  (function() {
			    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
			    po.src = 'https://apis.google.com/js/plusone.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			  })();
			</script>
		</li>
    	<li id="facebook">
		    <div id="fb-root"></div>
		    <script src="http://connect.facebook.net/en_US/all.js#appId=234100573279411&amp;xfbml=1"></script>
		    <fb:like href="http://www.minrivertea.com/teas/{{ tea.slug }}" send="false" layout="button_count" width="80" show_faces="true" font="">
		    </fb:like>
		</li>
	</ul>
	{% endif %}

</div>
</div>
{% endblock %}
