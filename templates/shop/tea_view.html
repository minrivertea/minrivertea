{% extends "base.html" %}
{% load thumbnail %}
{% load django_static %}

{% block metadescription %}{% if tea.meta_description %}{{ tea.meta_description|safe }}{% else %}{{ tea.name }} - {{ tea.description|safe }}{% endif %}{% endblock %}
{% block pagetitle %}{{ tea.meta_title }}{% endblock %}

{% block extrajs %}
<script>
$(function() {

$(".scrollable").scrollable();

$(".items img").click(function() {

	if ($(this).hasClass("active")) { return; }
	var url = $(this).attr("alt");
	var wrap = $("#image_wrap").fadeTo("medium", 0.2);

	var img = new Image();
    
	img.onload = function() {
		wrap.fadeTo("fast", 1);
		wrap.find("img").attr("src", url);	
	};

	img.src = url;

	$(".items img").removeClass("active");
	$(this).addClass("active");

}).filter(":first").click();
});


function notifyFormSubmit() {
	$('#notify-form').submit( function() {
		$('#coming-soon').css('opacity', '0.5');
    	$.ajax({  
        	type: "POST",  
        	data: $('#notify-form').serialize(),  
        	url: "{% url tea_view tea.slug %}",  
        	cache: false,  
        	dataType: "html",  
        	success: function(html, textStatus) {  
        	    $('#coming-soon').html(html);
        	    $('#coming-soon').css('opacity', '1'); 
        	},   
        });  
        return false;
	});
}

function addToBasket(idx) {
   $('a#add_to_basket_' + idx).click( function() {
   	  $('#price_' + idx).css('opacity', '0.5');
   	  $('#price_' + idx + ' .message').replaceWith('<div class="message"></div>').toggle();
   	  $('#price_' + idx + ' div.message').fadeIn(200);
   	  $.ajax({
   	      url: '/basket/add/' + idx,
   	      type: "GET",
   	      data: "xhr=true&id=" + idx,
   	      dataType: 'json',
   	      success: function(data){
    		$("#basket-number").replaceWith('<span id="basket-number">(' + data.quantity + ')</span>');
            $('#price_' + idx + ' .message').append(data.item).delay(3800).fadeOut(1200);
            $('#price_' + idx).css('opacity', '1');
  		  }
   	  })
   	  return false;
   });	
}

$(document).ready( function() {
    {% for price in prices %}
    addToBasket({{ price.id }});
    {% endfor %}
    notifyFormSubmit();
});


</script>
<script type="application/javascript" src="{% staticfile '/js/lightbox/jquery.fancybox-1.3.4.pack.js' %}"></script>
{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="{% staticfile '/css/fancybox/jquery.fancybox-1.3.4.css' %}" />
<style type="text/css">
h1 {
  font-size: 40px;	
  margin-bottom: 10px;
}

h1 span {
  font-size: 30px;
  color: #999;
  margin-left: 10px;	
}

div.product-photos-small {
    float: left;
    margin: 15px 0 0px;
    text-align: right;
}

div.tea-top div.main-image div.product-photos-small img {
    float: left;
    margin: 0 10px 0 0;
    opacity: 0.6;
}

div.tea-top div.main-image div.product-photos-small img:last-child {
  margin-right: 0;	
}

div.tea-top div.main-image div.product-photos-small img:hover {
  cursor: pointer;
  opacity: 0.8;	
  box-shadow: 0 1px 3px #999;
}

div.tea-top div.main-image div.product-photos-small img.active {
  opacity: 1;	
}

div.product-photos-small p {
    float: left;
    font-size: 13px;
    line-height: 1.3em;
    margin-top: 20px;
    text-align: right;
    width: 100px;
}

div.tea-top {
    float: left;
    margin: 10px 0 10px;
    padding-bottom: 30px;
}

.tea-top .description {
  width: 430px;
  float: left;	
}

div.tea-top div.description p {
  font-size: 25px;
  color: #333;	
  margin: 0 0 10px 0;
  text-shadow: 2px 2px 0 #fff;
}

div.tea-top div.description p.small {
  font-size: 18px;	
}

div.tea-top div.main-image {
    float: left;
    margin-right: 20px;
    padding: 0px 10px 10px 0;
    width: 500px;
}

div.tea-top div#prices {
    float: left;
    width: auto;
    margin: 15px 0 0;
}

div.tea-top div#prices div.price {
    float: left;
    margin: 0;
    width: 170px;
    position: relative;
}

div.tea-top div#prices div.price.large {
  width: 100%;
}


div.tea-top div#prices div.price.large p.price-description {
  width: 90px;
  float: left;
  margin-left: 10px;
  margin-bottom: 0px;	
}

div.tea-top div#prices div.price.large div.message {
  top: 60px;
  width: 260px;
}

div.tea-top div#prices div.price.last {
 margin-right: 0;
}

div.tea-top a.button {
    float: right;
    font-size: 22px;
    margin: 0;
    position: relative;
    width: 190px;
    background: #237A2A;
    background: -moz-linear-gradient(100% 100% 90deg, #237A2A, #399440) repeat scroll 0 0 transparent;
    /* Safari 4-5, Chrome 1-9 */ 
    background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#399440), to(#237A2A)); 
    /* Safari 5.1+, Chrome 10+ */ 
    background: -webkit-linear-gradient(#399440, #237A2A); 
    /* Opera 11.10+ */ 
    background: -o-linear-gradient(#237A2A, #399440); 
    border: 1px solid transparent;
    text-shadow: 0 -1px 1px #333333;
    box-shadow: none;
    color: #fff; 
    padding: 11px 20px 9px;
}

div.tea-top a.button:hover {
  box-shadow: 0 1px 3px #999;
  border: 1px solid #fff;
}

div.tea-top a.button.single {
    float: right;
    top: -5px;
    margin: 0;
}

div.tea-top div.tea-description {
  float: left;
  width: 330px;
  margin-top: 0px;
  margin-bottom: 0px;
}

div.price-text {
    color: #EE6464;
    float: left;
    font-size: 28px;
    font-weight: bold;
    height: 23px;
    letter-spacing: -1px;
    margin: 0;
    position: relative;
    top: -4px;
    width: 200px;
}

div.message {
   position: absolute;
   top: 105px;
   left: -10px;
   width: 160px;
   height: auto;
   display: none;
   z-index: 10;
   border: none;
   padding: 15px 15px;
   background-color: #fff;
   border: 1px solid #e1e1e1;
   border-radius: 5px;
}

div.message:after {
        content: " ";
        display: block;
        width: 0;
        height: 0;
        border-bottom: 15px solid #d1d1d1;         
        border-top: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        position: absolute;
        top: -15px;
        left: 25px;
        z-index: 1;
        margin-left: ;
}

.message:before {
        content: " ";
        display: block;
        width: 0;
        height: 0;
        border-bottom: 15px solid #fff;     
        border-top: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        position: absolute;
        top: -14px;
        left: 26px;
        z-index: 2;
        margin-left: -1px;
}

div.message p {
  margin: 0;
  font-size: 15px;
  font-family: Helvetica, Arial, sans-serif;
  line-height: 1.2em;
  color:  ;	
}

div.message p a {
  font-size: 20px;
  line-height: 1em;	
  color: #f37679;
  font-family: Helvetica, Arial, sans-serif;
}

div.message p a:hover {
  text-decoration: underline;	
}

div.message img {
  float: left;
  margin-right: 5px;
  margin-bottom: 15px;	
}

table.details {
    color: #333;
    font-size: 16px;
    margin-top: 10px;
    width: 660px;
}

table.details tr {
  padding-bottom: 10px;	
}

table.details td {
  padding: 15px;	
  background-color: #fff;
}

table.details td a {
  font-size: 12px;	
}

table.details td.left {
  padding-right: 10px;
  background-color: #E1ECF3;
  font-family: Helvetica, Arial, sans-serif;
  font-size: 14px;
}

ul.reviews {
    list-style-type: none;
    padding-left: 20px;
    margin-bottom: 0;
    margin-bottom: 20px;
}

ul.reviews li {
    margin-bottom: 20px;
    padding-bottom: 15px;
}

ul.reviews li span {
  color: #BE373A;	
}

h3.small {
  font-size: 15px;	
}

p.price {
    color: #237A2A;
    float: left;
    font-family: Helvetica,Arial,sans-serif;
    font-size: 40px;
    font-weight: bold;
    letter-spacing: -2px;
    line-height: 1em;
    margin: 0;
    position: relative;
    text-shadow: 1px 1px 0 #FFFFFF;
}

p.price span.grey {
  color: #555;
  font-weight: bold;
  font-size: 20px;
  text-shadow: none;
}



p.price-description {
    color: #333333;
    float: left;
    font-size: 12px;
    line-height: 1.2em;
    margin: 0 0 0 5px;
    width: 90px;
    position: relative;
}


div.fb-recommend {
  margin-top: 20px;
  float: left;	
}

#coming-soon {
    float: left;
    height: 85px;
    width: 400px;
}

#coming-soon p {
  font-size: 12px;
  margin: 0 0 10px 0;
}

#coming-soon p.message {
    color: #333;
    font-size: 20px;
}

#coming-soon p.message strong {
  color: #F37679;	
}

#coming-soon span {
  font-size: 22px;
  color: #EE6464;
}

#coming-soon span.green {
  color: #1C7600;
  line-height: 1.6em;
  font-size: 20px;
}

#coming-soon input {
  float: left;
  width: 250px;	
}

#coming-soon input.button {
    font-weight: bold;
    font-size: 15px;
    height: 41px;
    padding: 7px;
    width: 110px;
    position: relative;
    left: -3px;
    border-left: none;
    border-radius: 0 4px 4px 0;
}

#coming-soon input.button:hover {
  cursor: pointer;	
  background-color: #359318; 
}

#facebook, #google {
  float: left;
  width: 80px;
}

#google {
  margin-bottom: 10px;
}


#price-helper {
    float: right;
    height: 25px;
    margin: 15px 30px 0 0px;
    width: 380px;
    text-align: right;
    font-family: Helvetica,Arial,sans-serif;
    color: #333;
    font-size: 13px;
}

#price-helper a {
  font-size: 13px;	
  font-weight: bold;
}

#price-helper a.not-in-stock {
  font-size: 16px;
  color: #F37679;	
}

.loading {
    left: 240px;
    position: absolute;
    top: 160px;
    z-index: -1;
}

#extras {
  width: 100%;
  float: left;
  margin: 0 0 40px 0;	
}

#extras div.info {
  width: 200px;
  height: 280px;
  margin-right: 10px;
  padding: 15px 25px;	
}

#extras div.info.long {
  margin-right:0;
  width: 380px;
  padding: 15px 25px;	
}

#extras .info h4 {
  font-weight: bold;
  font-size: 18px;
  color: #237A2A;
  font-family: Helvetica, Arial, sans-serif;
  margin: 10px 0 0 0;	
}

#extras .info h4.pink {
  color: #F37679;	
}

#extras .info p {
  font-size: 16px;
  margin: 0;
}
	
#extras .info .item {
  float: left;
  width: 360px;
  margin: 10px 15px 0 0;
  border-bottom: 2px dotted #e1e1e1;	
  padding-bottom: 20px;
}

#extras .info .item:last-child {
  border-bottom: none;
  margin-top: 20px;	
}

#extras .info .item img {
  float: left;
  margin-right: 15px;	
}

#extras .info .item a {
  font-family: Helvetica, sans-serif;	
}

#extras .info .item p {
  font-size: 14px;	
  margin: 0;
  line-height: 1.4em;
}

</style>
{% endblock %}


{% block currency %}
	{% include 'shop/snippets/currency.html' %}
{% endblock %}


{% block content %}



<div id="main-text-wide">
  <div class="super">
  
  
  	{% if ga_is_on %}
    <ul class="rss">
		<li id="google">
			<g:plusone></g:plusone>
			<script type="text/javascript">
			  (function() {
			    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
			    po.src = 'https://apis.google.com/js/plusone.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			  })();
			</script>
		</li>
    	<li id="facebook">
		    <div id="fb-root"></div>
		    <script src="http://connect.facebook.net/en_US/all.js#appId=234100573279411&amp;xfbml=1"></script>
		    <fb:like href="http://www.minrivertea.com/teas/{{ tea.slug }}" send="false" layout="button_count" width="80" show_faces="true" font="">
		    </fb:like>
		</li>
	</ul>
	{% endif %}
	
	<h1>{% if tea.long_name %}{{ tea.long_name|safe }}{% else %}{{ tea.name }}{% endif %}</h1>

     	
	<div class="tea-top">
		<div class="main-image">
			<img class="loading" src="{% staticfile '/images/loading.gif' %}"/>
			<div id="image_wrap">	
				<img src="http://static.flowplayer.org/tools/img/blank.gif" width="500x331" height="auto" /> 
			</div>
		    <div class="product-photos-small">
			<div class="scrollable">   
			   <div class="items">
  			    <div>
  			        {% thumbnail tea.image "60x60" crop="center" as im %}
  			    		{% thumbnail tea.image "500x331" crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.description }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					
					{% if tea.image_2 %}
  			    	{% thumbnail tea.image_2 "60x60" crop="center" as im %}
  			    		{% thumbnail tea.image_2 "500x331" crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_2_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_3 %}
					{% thumbnail tea.image_3 "60x60" crop="center" as im %}
  			    		{% thumbnail tea.image_3 "500x331" crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_3_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_4 %}
					{% thumbnail tea.image_4 "60x60" crop="center" as im %}
  			    		{% thumbnail tea.image_4 "500x331" crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_4_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_5 %}
					{% thumbnail tea.image_5 "60x60" crop="center" as im %}
  			    		{% thumbnail tea.image_5 "500x331" crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_5_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
      			</div>
      		  </div>
      		</div>
		</div><!-- end product photos small -->
		</div>
		
		<div class="description">{{ tea.body_text|safe }}</div>
		
		<div id="prices">
		  
			{% ifequal prices.count 1 %}
				{% for price in prices %}
		    	  <div id="price_{{ price.id }}" class="price large">
		    	  	<div class="message"></div>
		    		<p class="price">{{ price.price_unit }}{{ price.price|floatformat }}</p> 
		    		<p class="price-description">{{ price.description }}</p>
					<a title="Add 1x {{ tea.name }} ({{ price.weight|floatformat }}{{ price.weight_unit }}) to your basket" href="{% url add_to_basket price.id %}" class="button single" id="add_to_basket_{{ price.id }}">Add to basket +</a>
              	</div>
           		{% endfor %}

			{% else %}
		    	{% for price in prices %}
		    	  <div id="price_{{ price.id }}" class="price{% if forloop.last %} last{% endif %}">
		    	  	<div class="message"></div>
		    		<p class="price">{{ price.price_unit }}{{ price.price|floatformat }}</p> 
		    		<p class="price-description">{{ price.description }}</p>
					<a title="Add 1 {{ tea.name }} ({{ price.weight|floatformat }}{{ price.weight_unit }}) to your basket" href="{% url add_to_basket price.id %}" class="button" id="add_to_basket_{{ price.id }}">Add to basket +</a>
            	  </div>
           		{% endfor %}
           	{% endifequal %}
        </div>

		<div id="price-helper">        
        	{% if tea.coming_soon %}
       			<a href="" class="not-in-stock">We're restocking this tea now!</a><br/>Pre-order this tea now and it will be delivered on {{ tea.get_preorder_date|date:"d M Y" }}</a>
        	{% else %}
				<a href="/where-do-we-deliver/">Wondering where we deliver?</a><br/>
				UK, USA and Europe for just {{ currency.symbol }}{{ currency.postage_cost }} per order
			{% endif %}
		</div>
		

	</div><!-- end top product info div -->

	<div id="extras">
		{% if tea.extra_info %}
		<div class="info">
			{{ tea.extra_info|safe }}
		</div>
		{% endif %}
		{% if reviews %}
		<div class="info">
			{% for review in reviews %}
			<h4 class="pink">{{ review.first_name }} says:</h4>
			<p>&ldquo;<em>{{ review.short_text }}</em>&rdquo;</p>
			<p><span class="red">{{ review.first_name }} {{ review.last_name }}</span></p>
			{% if review.url %}
				<a href="{{ review.url }}">{{ review.show_url }}</a>
			{% endif %}
			{% endfor %}
		</div>
		{% endif %}
		{% if tea.recommended.all %}
		<div class="info long">
			<h4>Also highly recommended…</h4>
			{% for o in tea.recommended.all %}
			<div class="item">
				<a href="{% url tea_view o.slug %}">
					{% thumbnail o.image "100" crop="center" as im %}
						<img src="{{ im.url }}"/>
					{% endthumbnail %}
				</a>
				<p><strong><a href="{% url tea_view o.slug %}">{{ o.name }}</a></strong><br/>{{ o.description|truncatewords:10 }}</p>
				
			</div>
			{% endfor %}
		</div>
		{% endif %}
	</div>


	<div id="left">
 	
		<h2>More information</h2>
		{{ tea.long_description|safe }}
		{% if ga_is_on %}
		<div class="fb-recommend">
		<div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#appId=102598969829350&amp;xfbml=1"></script><fb:like href="http://www.minrivertea.com{{ tea.get_absolute_url }}" send="false" width="450" show_faces="false" action="recommend" font=""></fb:like>
		</div>
		{% endif %}
		
	

	
	
			
						 
</div>

</div>
</div>
{% endblock %}
