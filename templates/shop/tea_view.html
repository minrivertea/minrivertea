{% extends base_template %}
{% load thumbnail i18n convert_weights convert_links mathfilters %}

{% block metadescription %}{% if tea.meta_description %}{{ tea.meta_description|safe }}{% else %}{{ tea.name }} - {{ tea.description|safe }}{% endif %}{% endblock %}

{% block pagetitle %}{% if not tea.meta_title %}{{ tea.name }}{% else %}{{ tea.meta_title }}{% endif %}{% endblock %}

{% block canonical %}<link rel="canonical" href="{{ site_url }}{{ tea.get_absolute_url }}" />{% endblock %}

{% block extra-head %}
<meta property="og:type" content="product" />
<meta property="og:title" content="{{ tea.name }}" />
<meta property="og:url" content="{{ site_url }}{{ tea.get_absolute_url }}" />
<meta property="og:description" content="{{ tea.description|safe }}" />
<meta property="og:site_name" content="Min River Tea" />
{% thumbnail tea.image "500x500" crop="center" as im %}
<meta property="og:image" content="{{ im.url }}" />
<meta name="twitter:image" content="{{ im.url }}" />
{% endthumbnail %}
<meta name="twitter:title" content="{{ tea.name }}" />
<meta name="twitter:site" content="@minrivertea" />
<meta name="twitter:card" content="product" />
<meta name="twitter:description" content="{{ tea.description|safe }}" />
{% endblock %}

{% block extrajs %}
<script>

$(".price span[title]").tooltip({
  offset: [-8, 2],   
});

$("#deals img[title]").tooltip({
  offset: [-8, 2],   
});

$(function() {

    $(".scrollable").scrollable();
    $(".items img").click(function() {
    
    	if ($(this).hasClass("active")) { return; }
    	var url = $(this).attr("alt");
    	var wrap = $("#image_wrap").fadeTo("medium", 0.2);
    
    	var img = new Image();
        
    	img.onload = function() {
    		wrap.fadeTo("fast", 1);
    		wrap.find("img").attr("src", url);	
    	};
    
    	img.src = url;
    
    	$(".items img").removeClass("active");
    	$(this).addClass("active");
    
    }).filter(":first").click();
});


$(document).ready( function() {
    
    $('#reviews .toggle').click( function() {
       
       var html = '<h2>{% trans "Reviews for" %} {{ tea.name }}</h2><div class="hr"></div><ul class="reviews">'
       html += $('#reviews ul').html();
       html += '</ul>';
       makeOverlay(html, '800');
       
    });
});


</script>

{% endblock %}

{% block extracss %}
<style type="text/css">

div.introduction h1 {
  margin: 0 0 20px 0;   
}

div.introduction p{
  margin: 0;   
}

h1 span {
  font-size: 30px;
  color: #999;
}

.product-photos-small {
    float: left;
    margin: 0px 0 0px 5px;
    text-align: right;
    width: 50px;
    position: relative;
    left: 5px;
}

.product-photos-small img {
    float: left;
    margin: 0 0px 5px 0;
    opacity: 0.6;
    border: 1px solid #e1e1e1;
}

.product-photos-small img:last-child {
  margin-right: 0;	
}

.product-photos-small img:hover {
  cursor: pointer;
  opacity: 0.8;	
  border-color: #d1d1d1;
}

.product-photos-small img.active {
  opacity: 1;	
}

#deals {
 float: left;
 width: 100%;  
}

#deals p {
 margin: 0; 
 font-size: 15px;  
}

#deals p .title {
  color: #FF6569;
}


#deals .item {
  width: 50px;
  height: auto; 
  float: left;
  display: block;  
  text-align: center; 
  font-size: 11px; 
}

#deals .item img {
  float: left;
  margin: 0 0 5px; 
  height: 50px;
}

#deals span.text {
  position: relative;
  float: left;
  width: 25px;
  top: 15px;
  text-align: center;
  color: #999;
  font-size: 22px;   
}

#instructions {
  position: absolute;
  bottom: 0;
  right: 0;	
  display:none;
}

#instructions div {
  float: right;
  height: 50px;
  width: 50px;
  margin: 0 0 0 5px;
  background: #f1f1f1;
  position: relative;
}

#instructions div span.title {
  font-weight: bold;
  font-size: 12px;
  letter-spacing: -0.5px;
  color: #b1b1b1;
  float: left;
  width: 100%;
  text-align: center;
  position: absolute;
  top: 5px;
  left: 0;
  text-transform: lowercase;	
}

#instructions div span.num {
  font-size: 20px;
  font-weight: 100;
  letter-spacing: -0.5px;
  position: absolute;
  top: 22px;
  color: #777;
  width: 100%;
  text-align: center;	
}

#instructions div:hover span.num {
  color: #18691E;   
}

#instructions div:hover span.title {
  color: #555;   
}

.tea-top {
    background: none repeat scroll 0 0 #FFFFFF;
    padding: 0;
}

.tea-top .left {
  margin: 0px 0 0 0;   
}


.tea-top div.description p {
  font-size: 18px;
  font-weight: 100;
  margin: 0 0 10px 0;
}

.tea-top .description p:last-child {
  margin-bottom: 0;   
}

.tea-top div.description p.small {
  font-size: 13px;
  font-weight: normal;	
}

.tea-top div.main-image {
    float: left;
    width: 565px;
    position: relative;
}

.tea-top #prices {
    position: relative;
}

.tea-top #prices p {
  margin: 0 0 20px 0; 
  font-size: 13px;
  line-height: 1.8em;  
}

#prices #loading {
    float: left;
    left: 40%;
    margin: 0;
    position: absolute;
    top: 20px;
    z-index: 30;
}

#prices .message {
    background: none repeat scroll 0 0 #F1F1F1;
    border-radius: 5px 5px 5px 5px;
    display: none;
    float: left;
    padding: 40px 30px;
    position: absolute;
    right: -5px;
    text-align: center;
    top: -110px;
    width: 340px;
    z-index: 30;
}

#prices .message h3 {
    color: #333;
    font-size: 15px;
    font-weight: bold;
    margin: 0;
    text-transform: none;
    text-shadow: none;
}

#prices .message h3 a {
}

#prices .message h3 a:hover {
  text-decoration: underline;   
}

#prices .price {
    position: relative;
    border-bottom: 1px dashed #e1e1e1;
    margin: 0;
}

#prices .price .disabled {
  position: absolute;
  width: 100%;
  height: 100%;
  z-index: 1000;
  opacity: 0.9;
  background: #fff;
  top: 0;
  left: 0; 
  text-align: center;  
}

#prices .price .disabled p {
  margin-top: 1em;   
}


.tea-top .price .price-inner {
  width: 100%;
  float: left;   
}

#prices .price .warning, #prices .price .note {
    background: none repeat scroll 0 0 #C30000;
    border-radius: 4px 4px 4px 4px;
    color: #FFFFFF;
    float: left;
    font-size: 11px;
    font-weight: bold;
    padding: 2px 5px 3px;
    width: auto;
    position: relative;
    top: 0px;
}

#prices .price .note {
   background: #e1e1e1;
   color: #555;   
}

#prices .price p.special-shipping-time {
    float: left;
    font-size: 11px;
    line-height: 1.4em;
    margin: 15px 0 0;
    padding: 0;
    text-align: left;
    width: 60%;
    color: #5F829A;
}

#prices a.button {
    float: right;
}

a.button.red {
  background: #C30000;   
}

a.button.red:hover {
  background: #df4646;   
}

.tea-top div.tea-description {
  float: left;
  width: 330px;
  margin-top: 0px;
  margin-bottom: 0px;
}

.price-text {
    color: #EE6464;
    float: left;
    font-size: 28px;
    font-weight: bold;
    height: 23px;
    letter-spacing: -1px;
    margin: 0;
    position: relative;
    top: -4px;
    width: 200px;
}

#stocks {
    float: left;
    border-radius: 4px;
    font-size: 11px;
    font-weight: ;
    margin: 10px 0 10px;
    width: 100%;
}

#stocks div {
  padding: 0 10px;
  text-align: left;
  color: #555; 
}

#stocks div:first-child {
  padding-left: 0;   
}

#stocks div:last-child {
  border-right: none; 
  padding-right: 0;  
}

#stocks a.button.notify {
  float: right;    
}

#stocks strong {
  color: #444;  
}


table.details {
    margin-top: 10px;
}

table.details tr {
  padding-bottom: 10px;	
}

table.details td {
  padding: 15px;	
  background-color: #fff;
}

table.details td a {
  font-size: 12px;	
}

table.details td.left {
  padding-right: 10px;
  background-color: #E1ECF3;
}

span.name {
  font-weight: bold;
  font-size: 14px;   
}

.price-description {
  letter-spacing: -0.2px;
  position: relative;
  top: 8px;
}

#prices .amount {
  color: #333;
  font-size: 15px;
  font-weight: bold;
  letter-spacing: -0.5px;
}

.price .weight {
    color: #555555;
    font-size: 15px;
}

.price .weight span {
  color: #666;
}

div.fb-recommend {
  margin-top: 20px;
  float: left;	
}

#facebook, #google, #twitter {
  float: left;
  width: 80px;
}

#loading {
    left: 47%;
    position: absolute;
    top: 36%;
    z-index: 5;
}

#recommended, #delivery, #payment, #monthly {
  float: left;
  width: 100%;
  margin: 0px 0 0 0;   
}



#reviews h3, #shipping h3 {
  font-size: 18px;
  color: #5F829A;   
}

#shipping p {
  margin: 0;
  font-size: 13px;   
}


#reviews .toggle {
    background: none repeat scroll 0 0 #F6F6F6;
    border-bottom: 1px dashed #C1C1C1;
    bottom: -26px;
    color: #2A8531;
    font-size: 12px;
    font-weight: bold;
    margin: 0 auto;
    padding: 7px 0 5px;
    position: absolute;
    left: 10px;
    text-align: center;
    width: 150px;
}

#reviews .toggle:hover {
  cursor: pointer;   
}

#recommended h3 {
    color: #5F829A;
    margin: 0 0 10px;
    font-size: 17px;
}

#reviews a.add-review {
  position: absolute;
  bottom: -10px;
  right: 50px;   
}


#reviews ul {
  list-style-type: none;
  padding: 0;
  margin: 0; 
  overflow: hidden;  
}

#reviews ul li {
    font-size: 13px;
    letter-spacing: -0.2px;
    line-height: 1.8em;
}

#reviews ul li.hidden {
  display: none;   
}

#image_wrap {
    display: block;
    height: 331px;
    width: 500px;
    float: left;
}

#description, #brewing {
  background: none;
  padding: 0;
  width: 100%;  
  margin: 0 30px 0 0; 
}

#brewing {
  margin-right: 0;
  width: 345px;   
}

#extras .box {
  float: right;
  width: 345px;   
}

#extras .info {
   
}

#extras .info table {
  background: transparent;
}

#extras .info table td {
  background: transparent;
  padding: 0px;    
}

#extras .info table td:first-child {
  font-weight: bold;
  padding: 0 3px 0 0;   
}

#description .info img {
  float: left; 
  margin: 0 30px 20px 0;  
}

#description .info .text {
  float: left;
  background: #f1f1f1;
  padding: 20px; 
  width: 290px; 
  position: relative;
}

#description .info .text h4 {
  margin: 0;   
}

#description .info .text p {
  font-size: 13px;   
}

#description .info .text:before {
    border-color: transparent #f1f1f1 transparent -moz-use-text-color;
    border-style: solid solid solid none;
    border-width: 20px 20px 20px 0;
    content: " ";
    display: block;
    position: absolute;
    left: -20px;
    top: 20px;     
}

#map {
  background: none;
  padding: 0;
  width: 255px;
  margin: 0 30px 0 0;
  position: relative;  
} 

#map img {
  float: left;
  margin: 0 0 15px 0;   
}

#map p {
  font-style: italic;   
}

#shipping.info, #safe.info {
  width: 325px;
  float: right;
  padding: 10px;
  margin: 10px 0 0 0;  
}

#shipping img, #safe img {
  margin: 0;   
}



{% if reviews %}
ul.rss { 
    right: 0;
    top: -5px;
}
{% endif %}


#delivery h3, #payment h3, #extras h3, #monthly h3 {
  margin: 0;
  float: left;
  color: #5F829A;
}

.border-right {
  border-right: 1px dashed #e1e1e1;   
}


#delivery p, #payment p, #reviews p, #monthly p {
  margin: 10px 0 0 20px;
  float: left;
  font-size: 13px;
  color: #999;
}

#payment span.image {
    background: url("{{ static_url }}images/logo16.jpg") no-repeat scroll -164px -145px transparent;
    float: left;
    height: 36px;
    width: 284px;
    margin: -5px 0 0 20px;
}

.not-in-stock {
    font-size: 15px;
    font-weight: bold;
    color: #D30000;   
}

</style>
{% endblock %}


{% block content %}


<div class="sp">
	
	<div class="introduction pure-g">	    	
        <h1 class="pure-u-1">
            {% if tea.long_name %}{{ tea.long_name|safe }}{% else %}{{ tea.name }}{% endif %}
        </h1>
	   
	</div>

	<div class="tea-top pure-g">
		<div class="left pure-u-3-5">
		  <div class="main-image">
			<div id="image_wrap">	
				<img src="{{ static_url }}images/blank.gif" width="500px" height="331px" /> 
			</div>
		
		    <div class="product-photos-small">
			<div class="scrollable">   
			   <div class="items">
  			    <div>
  			        {% thumbnail tea.image thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.description }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					
					{% if tea.image_2 %}
  			    	{% thumbnail tea.image_2 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_2 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_2_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_3 %}
					{% thumbnail tea.image_3 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_3 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_3_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_4 %}
					{% thumbnail tea.image_4 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_4 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_4_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
					
					{% if tea.image_5 %}
					{% thumbnail tea.image_5 thumb_small crop="center" as im %}
  			    		{% thumbnail tea.image_5 thumb_large crop="center" as im_large %}
						<img class="product-small" alt="{{ im_large.url }}" title="{{ tea.image_5_caption }}" src="{{ im.url }}"/></a>
						{% endthumbnail %}
					{% endthumbnail %}
					{% endif %}
      			</div>
      		  </div>
      		</div>
		</div><!-- end product photos small -->
		
		</div><!-- end main image div -->
	</div>
	
	<div id="prices" class="pure-u-2-5 l-pad">
        <p class="pure-u-1 r-pad">{{ tea.body_text|striptags }}</p>
            
            <div class="pure-g">
            {% if tea.is_active %}
                {% for price in prices %}
                  <div id="price_{{ price.id }}" class="pure-u-1 half-pad price{% if price.sale_price %} sale{% endif %}">
        		    
        		    <div class="pure-g">
        		    	
        		    
                      <div class="price-description pure-u-16-24">
                        
                        <div class="pure-g">
                            
                            <span class="weight pure-u-1-3">
                                {% if price.weight %} 
                                    {% convert_weights request price.weight %}{{ weight_unit }}
                                {% else %} 
                                    {{ price.description }}
                                {% endif %} 
                            </span>
                            
                            <span class="amount pure-u-2-3">
                                {% if price.stocks.available %}
                                    {% if price.sale_price %}
                                        <span class="strikethrough red small">
                                            {{ currency.symbol }}{{ price.price|floatformat:"2" }}
                                        </span>
                                    {% endif %}
                                    {{ currency.symbol }}{{ price.get_price|floatformat:"2" }}
                                {% else %}
                                    <span class="red small"><strong>Out of Stock</strong></span>
                                {% endif %}
                            </span>                 
                            
                        </div> 
                      </div>                      
                      
                      
                      {% if price.stocks.preorder %}
                         <a class="button orange pure-u half-pad" id="{{ price.id }}" href="{% url add_to_basket price.id %}"><span title="{% trans 'Order now and receive this on' %} {{ tea.get_preorder_date|date:'d M Y' }}">{% trans 'Click to Preorder' %}</span></a>
                      {% endif %}
                      
                      
                    {% if price.stocks.available %} 
                    <a href="{% url add_to_basket price.id %}" class="button {% if price.stocks.available %}green{% else %}grey{% endif %} pure-u half-pad" id="{{ price.id }}">{% trans 'Buy' %}</a>
                    
                    {% else %}                    
                        <a href="#" class="button orange pure-u half-pad notify" data-id="{{ tea.id }}" data-name="{{ tea.name }}">
                            {% trans "Notify me" %}
                        </a>
                    {% endif %}
                                    
                    </div>
                  </div>    
        	    
        	    {% endfor %}
	    
                <div id="stocks" class="pure-g"> 
		
                    <div class="postage-cost pure-u">
                    {% blocktrans with currency.symbol as sym and currency.postage_cost as pc and currency.postage_discount_threshold as pdt %}
                        <strong>{{ sym }}{{ pc }}</strong> shipping, free over <strong>{{ sym }}{{ pdt }}</strong>{% endblocktrans %}
                    </div>
		  
                </div>

        {% else %}
          <div id="stocks">        
           	<span class="not-in-stock">{% trans 'This product is not currently available for sale.' %}</span>
          </div>	
    	  {% endif %}
  	     </div>
  	  </div>
		    
   	
	<div class="hr pure-u-1"></div>
	</div>
	<!-- END PRODUCT TOP -->	

	<!-- START EXTRAS -->
	{% if tea.long_description %}
	<div id="extras" class="pure-g">
	
      	<div id="description" class="pure-u-1">
      	   {{ tea.long_description|convert_links|safe }}
      	</div>
	
	</div>
	<div class="hr"></div>
	{% endif %}
	<!-- END EXTRAS -->
	
	
	<!-- START REVIEWS -->
    {% if reviews %}
    <div class="sp pure-g">
        <div id="reviews" class="pure-u-1-2 l-pad r-pad border-right">
        
            <h3>{% trans 'What do our customers say?' %} 
                <a href="{% url review_tea tea.category.slug tea.slug %}">
                    {% trans 'Add your own review' %} &raquo;
                </a>
            </h3>
            
            <ul class="pure-g">
            {% for r in reviews %}
               <li class="pure-u-1 {% if not forloop.first %}hidden{% endif %}">
                   &ldquo;<em>{{ r.short_text }}</em>&rdquo;<br/>
                   {% if r.first_name or r.last_name %}
                   <strong>{{ r.first_name }} {{ r.last_name }}</strong>
                   {% if r.date_submitted %} - {{ r.date_submitted|date:"d M Y" }}{% endif %} 
                   {% if r.url %} - <a href="{{ r.url }}">view original</a>{% endif %}
                   {% endif %}
               </li>
           {% endfor %}
            </ul>
        
            {% if reviews.count > 1 %}
                <span class="toggle">{% trans 'Show more reviews' %}</span> 
            {% endif %}
           
        </div>
        
        <div id="shipping" class="pure-u-1-2">
            <div class="pure-g">
                <div class="pure-u-1-2 l-pad r-pad border-right">
                    <h3>{% blocktrans with currency.symbol as symbol and currency.postage_discount_threshold as ptd %}Free delivery over {{ symbol }}{{ ptd }}{% endblocktrans %}</h3>
                    {% url page _('shipping') as shipurl %}
        	       <p>{% blocktrans %}Read more info about our <a href="{{ shipurl }}">
        	           FREE worldwide shipping</a>{% endblocktrans %}
        	       </p>
                </div>
                
                <div class="pure-u-1-2 l-pad r-pad">
                    <h3>{% trans 'Easy and secure payment' %}</h3>
          <span class="image"></span>
          {% url page _('terms-and-conditions') as tcurl %}
          {% url page _('returns') as rturl %}
          <p>{% blocktrans %}Read our <a href="{{ tcurl }}">T&Cs</a> and <a href="{{ rturl }}">Returns</a> policies{% endblocktrans %}</p>
                </div>
            </div>
        </div>
	       
    </div>        
        
    <div class="hr"></div>
    {% endif %}
    <!-- END REVIEWS -->
	
	
	<!-- START DEALS -->
    {% for price in prices %}
        {% if price.get_deals %}
            {% include 'shop/snippets/deal.html' %}     
        {% endif %}
    {% endfor %}
    <!-- END DEALS -->


 
	<div id="recommended">
	   <h3 class="title">{% trans 'Also recommended...' %}</h3>
	   {% with recommended as teas %}
            {% include 'shop/snippets/products_long.html' %}		  
	   {% endwith %}
	</div>

    {% if ga_is_on %}
    <ul class="rss">
		<li id="google">
			<div class="g-plusone" data-size="medium"></div>
			<!-- Place this tag after the last +1 button tag. -->
            <div style="display: none; width: 0;">
            <script type="text/javascript">
              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
            </script>
            </div>
		</li>
		<li id="twitter">
		      <a href="https://twitter.com/share" class="twitter-share-button" data-url="{{ site_url }}{{ tea.get_absolute_url }}" data-text="If you like tea, try some @minrivertea {{ tea.name }}" data-size="small">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
		
		</li>
    	<li id="facebook">
		    <div id="fb-root"></div>
		    <script src="http://connect.facebook.net/en_US/all.js#appId=234100573279411&amp;xfbml=1"></script>
		    <fb:like href="{{ site_url }}{{ tea.get_absolute_url }}" send="false" layout="button_count" width="80" show_faces="true" font="">
		    </fb:like>
		</li>
	</ul>
	{% else %}
	<ul class="rss"><li><img src="{{ static_url }}images/debug_social.jpg" /></li></ul>
	{% endif %}

</div>
{% endblock %}
