{% extends base_template %}
{% load thumbnail i18n convert_weights %}

{% block pagetitle %}{% trans 'Your basket' %} ({{ basket_quantity }}){% endblock %}
{% block metadescription %}{% trans 'Your basket - shop on {{ site_name }} and get the best prices and great tasting authentic Chinese teas delivered direct to your door.' %}{% endblock %}

{% block extrajs %}
<script type="text/javascript">
$("#link").click( function() {
	$("#form").toggle();
	$(this).toggle();
	$('#message').toggle();
});

$(document).ready( function() {
	$('a#wishlist').fancybox({
    	'autoDimensions':true,
    });
});
</script>
<script type="application/javascript" src="{{ static_url }}js/lightbox/jquery.fancybox-1.3.4.pack.js"></script>
{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="{{ static_url }}/css/fancybox/jquery.fancybox-1.3.4.css" />
<style type="text/css">

#basket {
  margin-bottom: 60px; 
  padding-left: 30px;  
}

.basket-row {
    border-bottom: 1px dashed #e1e1e1;
    float: left;
    height: auto;
    margin-bottom: 0px;
    padding: 15px 0;
    width: 650px;
    position: relative;
    color: #555;
    font-size: 15px;
}

.basket-row div.long {
  width: 390px;
  float: left;
}

.basket-row:first-child {
  padding-top: 0px;	
}

.basket-row.postage div.tea-weight, .basket-row.postage div.tea-total {
  padding-top: 0;	
}

.basket-row div {
  height: 50px;	
}

.basket-row.monthly div, .basket-row.postage div, .basket-row.totals div {
  height: auto;	
}

.basket-row.discount div {
  height: auto;	
}

.basket-row ul {
  margin: 0;
  padding: 0;
  list-style-type: none;	
}

.basket-row .tools ul li {
  float: left;
  width: 100%;	
}


.tea-name {
  float: left;
  width: 50px;
  margin-right: 15px;	
}

.tea-weight {
  float: left;
  width: 250px;
  line-height: 1.6em;
}

.tea-weight a, .tea-weight h3, .name {
  text-decoration: none;
  font-size: 18px;
  font-weight: 100;
  text-transform: lowercase;  
}

.strikethrough {
  text-decoration: line-through;	
}

.tea-price {
  float: left;
  width: 10px;
}

.basket-row .tea-quantity, .basket-row .tea-total {
    float: left;
    font-size: 15px;
    font-weight: 100;
    height: 40px;
    padding-top: 10px;
    text-align: center;
    width: 140px;
}

.basket-row.totals .tea-total {
  font-size: 20px;	
}


.basket-row.totals {
  color: #333;	
}


.basket-row.totals .tea-total {
  padding-top: 0;
}

.monthly .tea-weight ul {
  padding: 0 0 0 10px;   
}

.monthly .tea-weight a, .monthly .tea-quantity li {
  font-size: 15px;	
}

.monthly .tea-quantity, .monthly .tea-total, .basket-row.monthly .tools{
  padding-top: 30px;	
}

.monthly .tea-weight {
  width: 220px;	
}

.monthly .tea-quantity {
  width:170px;	
}



.tools a.remove {
    font-weight: bold;
}

.basket-row .tools {
  float: left;
  padding-top: 10px; 
  width: 30px;
  height: 40px;  
  text-align: center;
}


#totals {
    color: #666666;
    float: right;
    font-size: 35px;
    letter-spacing: -1px;
    padding-top: 15px;
    text-align: right;
}

.label {
  float: left;
  width: 100px;
  margin-top: 10px;	
}

.total {
  color: #1A6D18;
  text-align: right;
  margin-top: 10px;
  float: right;
  width: 200px;
  padding-right: 80px;
}

#checkout-button {
  float: left;
  margin: 30px 0 0 220px;   
}

a.plus, a.minus, a.remove {
  display: block;
  float: right;
  color: #e1e1e1;
  text-decoration: none;	
  font-size: 17px;
}

a.minus {
  position: relative;
  top: 2px;
  font-size: 15px;	
}

a.plus:hover, a.minus:hover, a.remove:hover {
  color: #FF6569;   
}

.basket-row.discount span#link {
  font-weight: bold;
  color: #439249;
}

.basket-row.discount span#link:hover {
  cursor: pointer;
  color: #F37679;	
}

.basket-row.discount #form {
    display: none;	
    float: left;
    margin: 0;
}

.basket-row.discount form input {
  margin: 0;   
}

.basket-row.discount form label {
  float: left;
  width: 520px;
  margin: 0;	
}

.discount input.button {
    border-radius: 0 4px 4px 0;
    font-size: 15px;
    left: -3px;
    padding: 10px;
    position: relative;
    top: 0;
    width: 160px;
}

div.discount span.red {
  padding-bottom: 10px;	
}

#mtw #wishlist-full {
  display: none;	
  position: absolute;
  top: 0;
  left: 0;
  height: 0px;
  width: 0px;
}

#wishlist-full h2 {
  color: #F37679;	
  font-size: 40px;
}

#wishlist-full .block {
    border-right: 1px solid #E1E1E1;
    float: left;
    margin: 20px 20px 30px 0;
    padding-right: 20px;
    width: 220px;
}

#wishlist-full div.block.last {
    border-right: none;
    margin-right: 0;
}

input#id_discount_code {
  width: 325px;	
}

.basket-row div.coming-soon {
    background: none repeat scroll 0 0 #FF6569;
    color: #fff;
    font-size: 12px;
    height: auto;
    padding: 10px 15px;
    position: absolute;
    right: -270px;
    top: 0px;
    width: 220px;
}

.basket-row div.coming-soon:before {
  content: " ";
  display: block;
  position: absolute;
  left: -10px;
  top:10px;
  border-color:  transparent #FF6569 transparent -moz-use-text-color;
  border-style: solid solid solid none;
  border-width: 10px 10px 10px 0px;     
}

#sub-basket {
    width: 900px;
    background-color: #f3f6f7;
    border: 1px solid #d9ebde;
    border-top: 1px solid #f1f1f1;
    padding: 10px 30px;
    float: left;
    position: relative;
    top: -40px;
    border-radius: 0 0 5px 5px;
}

#sub-basket p {
  margin: 0;
  text-shadow: 1px 1px 1px #fff;
  font-size: 20px;
  color: #5d8ea6;   
}

</style>
{% endblock %}


{% block currency %}
	{% include 'shop/snippets/currency.html' %}
{% endblock %}


{% block content %}

<div id="mtw">
  <div class="sp">
  	<h1>{% blocktrans count basket_quantity as counter %}Your basket ({{ basket_quantity }} item){% plural %}Your basket ({{ basket_quantity }} items){% endblocktrans %}</h1>
  	
  	<ul id="steps">
		<li>
			<a class="selected" href="{% url basket %}">1. {% trans 'Your basket' %} &raquo;</a>
		</li>
		<li>
			<a class="" href="{% url order_step_one %}">2. {% trans 'Your details' %} &raquo;</a>
		</li>
		<li>
			<a href="">3. {% trans 'Confirm and pay' %} &raquo;</a>
		</li>
		<li>
			<a href="">4. {% trans 'Get your tea!' %}</a>
		</li>
	</ul>

{% if basket_items or monthly_items %}

    <div class="hr"></div>

  <div id="basket">
	{% for thing in basket_items %}
	  <div class="basket-row">
	  
		<div class="tea-name">
			{% thumbnail thing.item.parent_product.image thumb_small crop="center" as im %}
			<img src="{{ im.url }}"/>
			{% endthumbnail %}
			<br/>
		</div>
		<div class="tea-weight">
		  <a title="{{ thing.item.parent_product.description }}" href="{{ thing.item.parent_product.get_absolute_url }}">
		      {% if thing.monthly_order %}Monthly TeaBox{% else %}{{ thing.item.parent_product.name }}{% endif %}
		  </a>
		      {% if thing.item.weight %}({% convert_weights request thing.item.weight %}{{ weight_unit }}) {% endif %}<br/>
		      {{ currency.symbol }}{{ thing.item.price }} {% trans 'each' %}<br/>
	   </div>
	   <div class="tea-quantity">
		  x {{ thing.quantity }}
		  
		  <a class="plus" href="{% url increase_quantity thing.id %}">&#x25B2;</a>
		  {% ifequal thing.quantity 1 %}{% else %} <a class="minus" href="{% url reduce_quantity thing.id %}">&#x25BC;</a>{% endifequal %}
		  
		</div>
		<div class="tea-total">
		  {{ currency.symbol }}{{ thing.get_price }}
		</div>
		<div class="tools">
		      <a class="remove" title="{% trans 'Remove from basket' %}" alt="{% trans 'Remove from basket' %}" href="{% url remove_from_basket thing.id %}">X</a>
		</div>
		{% if thing.item.stocks.count == 0 or thing.item.stocks == None %}
	    	<div class="coming-soon">{% blocktrans with thing.item.parent_product.get_preorder_date|date:"d M Y" as pod %}<strong>NOTE:</strong> this item is a pre-order and will be delivered separately on <strong>{{ pod }}</strong>{% endblocktrans %}</div>
	    {% endif %}
		
	  </div>
	{% endfor %}
	
    {% if monthly_items %}
	<div class="basket-row monthly">
	    <div class="tea-name">
	       <img src="" />
	    </div>
	    <div class="tea-weight">
    	    <h3>{% trans 'Monthly Box' %}</h3>
            <ul>
                {% for x in monthly_items %}
	               <li>
	                   <a href="{% url tea_view x.item.parent_product.slug %}">
	                       {{ x.item.parent_product }}
	                   </a> 
	               </li>
                {% endfor %}
            </ul>
        </div>
        <div class="tea-quantity">
            <ul>
                {% for x in monthly_items %}
                    <li>
                    	{{ x.months }} {% trans 'months' %} / 
                    	{% convert_weights request x.item.weight %}{{ weight_unit }}
                    
                    	<a class="plus" href="{% url increase_quantity x.id %}">&#x25B2;</a>
                    {% ifequal x.quantity 1 %}{% else %} <a class="minus" href="{% url reduce_quantity x.id %}">&#x25BC;</a>{% endifequal %}
                    
                    </li>
            {% endfor %}
           </ul>
        </div>
        <div class="tea-total">
           <ul>
            {% for x in monthly_items %}
                <li>{{ currency.symbol }}{{ x.get_price|floatformat:"2" }}
                
                </li>
            {% endfor %}
           </ul>
        </div>
        <div class="tools">
            <ul>
            {% for x in monthly_items %}
                <li>
                    <a title="{% trans 'Remove from basket' %}" alt="{% trans 'Remove from basket' %}" class="remove" href="{% url remove_from_basket x.id %}">X</a>
                </li>
            {% endfor %}
            </ul>
        </div>
	</div>
	{% endif %}
	
	<div class="basket-row postage">
		<div class="tea-name">&nbsp;</div>
		
		{% if postage_discount %}
	  	<div class="long">
	  		<span class="strikethrough name">{% trans 'Postage' %}</span><br/>
            <span class="small">{% blocktrans with currency.symbol as symbol and currency.postage_discount_threshold as pdt %}Your order is over {{ symbol }}{{ pdt }}, so there's no postage charge!{% endblocktrans %}</span>
        </div>  
        <div class="tea-total strikethrough">{{ currency.symbol }}{{ currency.postage_cost|floatformat:"-2" }}</div>
		{% else %}
		<div class="long">
			<span class="name">{% trans 'Postage' %}</span><br/>
			<span class="small">{% trans 'Delivered in 1-3 days' %} | {% trans 'Shipped from the UK' %}</span>
		</div>
		<div class="tea-total">{{ currency.symbol }}{{ currency.postage_cost|floatformat:"-2" }}</div>
		{% endif %}
	</div>
	
	<div class="basket-row discount">
		<div class="tea-name">&nbsp;</div>
		  {% if code %}
		  	
		  	<div class="tea-weight">{% blocktrans %}You have entered a discount code worth {{ percent|floatformat }}% off!{% endblocktrans %}</div>
		  	<div class="tea-quantity">&nbsp;</div>
		  	<div class="tea-total"><span class="red">-{{ currency.symbol }}{{ value|floatformat:"-2" }}</span></div>
		  {% else %}
		    {% if discount_message %}<span id="message" class="red">{{ discount_message }} - </span>{% endif %}
		  	<span id="link">{% trans 'Got a discount code?' %}</span>
		  	<div id="form">
				  	<form action="." method="post">
					<input type="text" name="discount_code" id="id_discount_code" class="clearMeFocus" title="{% trans 'Enter discount code here' %}"/>
					<input type="submit" class="button green" value="{% trans 'Apply discount' %}" id="submit"/>
					</form>
			</div>
		  {% endif %}
	</div>
	
	<div class="basket-row totals">
		<div class="tea-name">&nbsp;</div>
		<div class="long">
			<span class="name">Total</span>
		</div>
		<div class="tea-total">
			{{ currency.symbol }}{{ total_price|floatformat:"2" }}
		</div>
	</div>

	<br clear="all"/>
	  	<div id="checkout-button">		
		<a class="button green" href="{% url order_step_one %}">
		  {% trans 'Start checkout now' %} &raquo;
		  <span><strong>{% trans 'Next step' %}:</strong> {% trans 'Your details (no login or registration required)' %}</span>
		</a>
	</div>
	
  </div>
  
  
  <div id="right">
   	<div class="info">
      <h3 class="small"><img src="{{ static_url }}images/lock.gif"> {% trans 'Safe and secure payment' %}</h3>
      	<p>{% trans 'We accept all major credit and debit cards through Paypal' %}</p>
      	<div style="margin: 10px 0 0 0;background-image: url('{{ static_url }}images/logo15.jpg');background-position: 0px -94px; height: 60px; width: 240px;"></div>
      </div>  	
  	<div class="info">
  		<h3>
  	 	  <img style="float:right; margin-left: 5px; position:relative; top: -8px; left: 4px;" src="{{ static_url }}images/gift.png"/>
  				{% trans 'Create a wishlist from your basket' %}
  		</h3>
  		<p>{% trans 'A wishlist saves your basket so that other people can buy it for you as a gift.' %}</p>
  		<p><a style="font-weight: bold;" id="wishlist" href="#wishlist-full">{% trans 'How does it work?' %}</a></p>
  		<div id="wishlist-full" style="width: 800px; padding: 30px;">
  			<h2>{% trans 'How to make a Wishlist' %}</h2>
  			   <div class="block">
  				 <h3>1. {% trans 'Choose the teas you want' %}</h3>
  				 <p>{% trans 'Choose the teas and other products that you want to have - add them to your basket as normal, and go through the checkout.' %}</p>
  			   </div>
  			   <div class="block">
  				 <h3>2. {% trans 'We give you a unique URL' %}</h3>
  				 <p>{% trans "At the final stage of the order, click the 'Create Wishlist' link, and we'll give you a unique URL. Share it with friends and relatives." %}</p>
  			   </div>
  			   <div class="block last">
  				 <h3>3. {% trans 'Friends can buy items for you' %}</h3>
  				 <p>{% trans "Using your unique URL, friends and family can buy items from your wishlist for you. We'll deliver them direct to the address you provided." %}</p>
  			   </div>
			   <img src="{{ static_url }}images/wishlist-screenshot.jpg">
		</div>
  	</div>
 </div>
  	

	<div id="left">

		<h2>{% trans 'Buyer protection' %}</h2>
		<p>{% trans 'Your online safety is extremely important to us too. Your purchase has these guarantees:' %}</p>
		<ul>
		  <li><strong>{% trans "Returns policy" %}</strong> {% trans "we operate a 'no questions asked' returns policy. If you're not happy with your order, just get in touch." %}</li>
		  <li><strong>{% trans 'Safe payments' %}:</strong> {% trans 'payments are taken via Paypal. We never see your credit card details, and your online payment is secured by the highest standard industry technology.' %}</li>
		  <li><strong>{% trans 'Customer services' %}:</strong> {% trans 'if you need to contact us about anything, you can email us directly at' %} <a href="mailto:chris@minrivertea.com">chris@minrivertea.com</a>. </li>
		</ul>

	</div>

 

{% else %}
  <div id="basket">
	<p>{% trans "There's nothing in your basket - add something, quick! " %}<br/><a href="{% url teas %}">&raquo; {% trans 'Browse our selection of Chinese teas here.' %}</a></p>
  </div>
	<div class="did-you-know">
	<a href="/suggestions/"><span class="link"></span></a>
	<h3>{% trans 'Need some help choosing a tea?' %} <span class="grey">{% trans 'Let us help you' %} &raquo;</span></h3>
	</div>

{% endif %}

  </div>
</div>
{% endblock %}
