{% extends base_template %}
{% load thumbnail i18n %}

{% block metadescription %}{% if product.meta_description %}{{ product.meta_description|safe }}{% else %}{{ product.name }} - {{ product.description|safe }}{% endif %}{% endblock %}
{% block pagetitle %}{% if not product.meta_title %}{{ product.name }}{% else %}{{ product.meta_title }}{% endif %}{% endblock %}

{% block canonical %}
    
    <link rel="canonical" href="http://www.minrivertea.com{{ product.get_absolute_url }}" />


{% endblock %}


{% block extrajs %}
<script>

function addToBasket() {
   $('a.up').click( function() {
   	  var idx = $(this).attr('id');
   	  $('#price_'+idx).css('opacity', '0.5');
   	  $.ajax({
   	      url: '/basket/add/'+idx+'/monthly/12/',
   	      type: "GET",
   	      dataType: 'json',
   	      success: function(data){
              if ($('#userbasket').hasClass('selected')) {} else {
                 $('#userbasket').addClass('selected');
                 $('#userbasket #quantity').append('<br/><a href="{% url basket %}" title="{% trans 'View your basket' %}" alt="{% trans 'View your basket' %}">{% trans 'Checkout now' %} &raquo;</a>'); 
              }
              $('#quantity .p').text(parseFloat(data.basket_quantity).toFixed(2));
              $('#quantity .q').html(parseInt($('#quantity .q').html(), 10)+1);
              if ($('#price_'+idx+' .quantity').length) {
                $('#price_'+idx+' .quantity .num').html(parseInt($('#price_'+idx+' .quantity .num').html(), 10)+1);
              } else {
                 $('#price_'+idx).append('<span class="quantity"><span class="num">1</span> in basket!</span>');
              }
              $('#price_'+idx).animate({'opacity': '1'}, 200);
              $('#'+idx+' .quantity').addClass('flash').delay(3900).queue(function() {$(this).removeClass('flash')});
  		  }
   	  })
   	  return false;
   });	
}

function changeMonths() {
   $('#choose-months a.changemonths').click( function() {
       $('#products').html('<img id="loading" src="{{ static_url }}images/loading.gif"/>');
       var obj = $(this);
       $.ajax({
         url: obj.attr('href'),
         type: 'GET',
         dataType: 'json',
         success: function(data) {
            $('a.changemonths').removeClass('selected');
            obj.addClass('selected');
            $('#products').html(data.html);
            $('#userbasket #quantity .p').html(data.basket_quantity);
            $('#loading').remove();
            addToBasket();
         }
        
       }) 
       return false;  
   }); 
}

$(document).ready( function() {
    changeMonths();
    addToBasket();
});


</script>
{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="{{ static_url }}css/teas.css"/>
<style type="text/css">

#mtw #left {
  background: #fff;
  border: 10px solid #E1ECF3;
  padding: 55px 15px 15px;
  width: 910px;
  position: relative;   
}

#mtw #left h2 {
  background: #E1ECF3;
  padding: 10px;
  position: absolute;
  top: 0;
  left: 0;
  width: 930px; 
  font-family: Helvetica, Arial, sans-serif;  
  font-weight: bold;
  font-size: 24px;
  letter-spacing: -1px;
}

h1 {
  font-size: 40px;	
  margin-bottom: 10px;
}

h1 span {
  font-size: 30px;
  color: #999;
  margin-left: 10px;	
}

div.product-photos-small {
    float: left;
    margin: 0px 0 0px 15px;
    text-align: right;
    width: 50px;
}

.tea-top .left {
    float: left;
    height: auto;
    margin-right: 30px;
    width: 500px;
}

.tea-top div.main-image div.product-photos-small img {
    float: left;
    margin: 0 0px 10px 0;
    opacity: 0.6;
}

.tea-top div.main-image div.product-photos-small img:last-child {
  margin-right: 0;	
}

.tea-top div.main-image div.product-photos-small img:hover {
  cursor: pointer;
  opacity: 0.8;	
  box-shadow: 0 1px 3px #999;
}

.tea-top div.main-image div.product-photos-small img.active {
  opacity: 1;	
}

div.product-photos-small p {
    float: left;
    font-size: 13px;
    line-height: 1.3em;
    margin-top: 20px;
    text-align: right;
    width: 100px;
}

.tea-top {
    float: left;
    margin: 10px 0 30px;
    padding-bottom: 10px;
}

.tea-top .description {
  width: 430px;
  float: right;	
}

.tea-top div.description p {
  font-size: 20px;
  color: #333;	
  margin: 0 0 10px 0;
  text-shadow: 2px 2px 0 #fff;
}

.tea-top div.description p.small {
  font-size: 16px;	
}

.tea-top div.main-image {
    float: left;
    width: 500px;
}


a.button {
    float: right;
    font-size: 18px;
    margin: 0;
    position: relative;
    width: 170px;
    top: -5px;
    padding: 11px 20px 9px;
    text-align: right;
}

.price.big a.button {
   float: left;
}



.tea-top div.tea-description {
  float: left;
  width: 330px;
  margin-top: 0px;
  margin-bottom: 0px;
}

div.price-text {
    color: #EE6464;
    float: left;
    font-size: 28px;
    font-weight: bold;
    height: 23px;
    letter-spacing: -1px;
    margin: 0;
    position: relative;
    top: -4px;
    width: 200px;
}

div.message {
    background-color: #FFFFFF;
    border: 1px solid #C1C1C1;
    border-radius: 5px 5px 5px 5px;
    display: none;
    height: auto;
    padding: 15px;
    position: absolute;
    right: 0;
    top: -135px;
    width: 260px;
    z-index: 10;
}

div.message:after {
        content: " ";
        display: block;
        width: 0;
        height: 0;
        border-top: 15px solid #d1d1d1;         
        border-bottom: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        position: absolute;
        bottom: -15px;
        right: 25px;
        z-index: 1;
        margin-left: ;
}

.message:before {
        content: " ";
        display: block;
        width: 0;
        height: 0;
        border-top: 15px solid #fff;     
        border-bottom: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        position: absolute;
        bottom: -14px;
        right: 25px;
        z-index: 2;
        margin-left: -1px;
}

div.message p {
  margin: 0;
  font-size: 15px;
  font-family: Helvetica, Arial, sans-serif;
  line-height: 1.2em;
}

div.message p a {
  font-size: 20px;
  line-height: 1em;	
  color: #f37679;
  font-family: Helvetica, Arial, sans-serif;
}

div.message p span.tick {
  color: #237A2A;
  font-size: 30px;   
}

div.message p a:hover {
  text-decoration: underline;	
}

div.message img {
  float: left;
  margin-right: 5px;
  margin-bottom: 15px;	
}

table.details {
    margin-top: 10px;
}

table.details tr {
  padding-bottom: 10px;	
}

table.details td {
  padding: 15px;	
  background-color: #fff;
}

table.details td a {
  font-size: 12px;	
}

table.details td.left {
  padding-right: 10px;
  background-color: #E1ECF3;
  font-family: Helvetica, Arial, sans-serif;
  font-size: 14px;
}

span.name {
  font-family: Helvetica, sans-serif;
  font-weight: bold;
  font-size: 14px;   
}



.price-description {
    color: #555555;
    float: left;
    font-family: Helvetica,Arial,sans-serif;
    font-size: 12px;
    left: 5px;
    line-height: 1em;
    margin: 0 0 0 5px;
    position: relative;
    width: 90px;
}

.price-description span {
  color: #666;
}

.price.big .price-description {
  margin: 5px 0 15px 10px;
     
}


div.fb-recommend {
  margin-top: 20px;
  float: left;	
}

#facebook, #google {
  float: left;
  width: 80px;
}

#google {
  margin-bottom: 10px;
}

.loading {
    left: 240px;
    position: absolute;
    top: 160px;
    z-index: -1;
}

#recommended {
  float: left;
  width: 100%;
  margin: 0px 0 0 0;   
}

#recommended h3 {
  font-size: 24px;
  font-family: Helvetica, Arial, sans-serif;
  font-weight:bold;  
  margin: 0 0 20px 0; 
  color: #FF6569;
}

#recommended .text .price {
  width: auto;
  color: #777;
  font-weight: normal;
  margin-left: 0;   
}

#recommended .price strong {
  color: #333;   
}

#recommended .info {
  margin: 0 15px 20px 0;   
  height: 235px;
  width: 225px;
  background: #fff;
  border: 10px solid #E1ECF3;
}

#recommended .info.trans {
  margin: 0 15px 19px 0;
  padding: 0px;   
  width: auto;
  height: 160px;
  border-color: #fff;
}

#recommended .info .text {
   width: 230px;
   background: #fff;
   padding: 3px 5px 0;
   float: left;
   position: absolute;
   bottom: 0;
}

#recommended .info .text h3 {
  text-align: right;
  color: #6a9bba;
  font-size: 13px;
  margin: 6px 0 0 0;
}

#image_wrap {
    display: block;
    height: 331px;
    width: 500px;
    float: left;
}


#long-description, #brew {
  float: left;
  width: 300px;  
  margin: 0 30px 0 0; 
}

#long-description p, #brew p, #map p {
  font-size: 13px; 
  margin: 0 0 20px 0;  
}

#long-description h3, #brew h3 {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 14px;
  font-weight: bold;   
}

#map {
  float: left;
  width: 255px;
  margin: 0 30px 0 0;
  position: relative;  
} 

#map img {
  float: left;
  margin: 0 0 15px 0;   
}

#map h3 {
  font-family: Helvetica, sans-serif;
  font-size: 14px;
  font-weight: bold;   
}

#shipping {
  width: 300px; 
  background: transparent;
  border: none;
  padding: 0;
  margin: 10px 0 0 0;  
}

#shipping img {
  float: left; 
  margin: 0 0 25px 0;  
}

#shipping #shipping-amount {
    color: #999999;
    float: left;
    font-size: 40px;
    left: 12px;
    line-height: 1em;
    padding: 0;
    position: relative;
    text-shadow: 1px 1px 0 #FFFFFF;
    top: -2px;
}


#monthly, #choose-months {
    background: none repeat scroll 0 0 transparent;
    border-bottom: 3px dotted #E1E1E1;
    border-top: 3px dotted #E1E1E1;
    float: left;
    height: auto;
    margin: 0px 0 20px;
    padding: 20px 0;
    width: 100%;
    min-height: 100px;
}

#choose-months {
  border-bottom: none;   
}

#choose-months ul {
  float: left;
  list-style-type: none;
  margin: 0;
  padding: 0;   
}

#choose-months ul li {
  float: left;
  font-size: 13px;
  color: #59849F;
  padding-left: 10px;
  line-height: 1.2em;  
}

#choose-months ul li a {
    background: none repeat scroll 0 0 #FFFFFF;
    border-radius: 2px;
    float: left;
    font-size: 24px;
    margin: 0 20px 10px -10px;
    padding: 10px 20px;
    text-decoration: none;
    font-family: Helvetica, sans-serif;
    letter-spacing: -0.5px;
    font-weight:bold;
    text-shadow: none;
  line-height: 1.6em;  

}

#choose-months ul li a:hover {
  box-shadow: 0 1px 3px #d1d1d1;   
}

#choose-months ul li a.selected {
  background: #237A2A;  
  color: #fff; 
}

#choose-months ul li a.selected:hover {
  background: #FF6569;
  color: #fff;   
}

#monthly .button {
  width: 130px;
  font-size: 15px;
  padding: 5px 20px;
  text-align: center;  
  margin: 5px 0 0; 
  top: 0;
  float: left;
}

#monthly h3, #choose-months h3 {
    float: left;
    font-family: Helvetica,arial,sans-serif;
    font-size: 20px;
    font-weight: bold;
    letter-spacing: -0.5px;
    line-height: 1em;
    margin: 0 20px 0 0;
    position: relative;
    top: -5px;
    color: #FF6569;
    width: 210px;
}

#choose-months h3 {
  position: relative;
  top: 3px;
}

#monthly div {
  display: block;
  float: left;
  width: 500px;
  margin: 0 30px 0 0;
  font-size: 14px; 
  padding: 15px 0 0;  
}

#monthly .price {
  width: 180px; 
  margin: 0;
  padding-top: 10px;
  font-family: Helvetica, Arial, sans-serif;
  font-size: 15px;
  letter-spacing: -0.5px;
  color: #555;  
}

#monthly div.price span.grey {
    color: #777777;
    font-size: 13px;
    font-weight: normal;
}

#monthly div#products {
  width: 730px;
  padding: 0;
  margin: 0;   
}

#monthly #products .product {
    background: none repeat scroll 0 0 #FFFFFF;
    float: left;
    height: auto;
    margin: 0 0px 15px 0;
    padding: 1.5%;
    position: relative;
    width: 97%;
}

#monthly #products .product:hover {
  box-shadow: 0 1px 5px #d1d1d1;   
}

#monthly #products img {
  float: left;
  margin: 0 30px 0 0;
}

#monthly #products h4 {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 18px;
  float: left;
  margin: 5px 0 0;
  padding: 0;
  color: #237A2A;
  width: 438px;
  letter-spacing: -0.5px;   
}

#monthly #products p {
  float: left;
  width: 438px;
  padding: 0;
  margin: 0;
}

#monthly #products .product .price {
    bottom: 15px;
    float: left;
    font-size: 14px;
    left: 285px;
    margin: 0;
    position: absolute;
    width: 438px;
}

#monthly p.price span.amount {
  font-weight: bold;
  color: #333;
  font-size: 18px; 
}

#monthly p.price a.up {
    background: none repeat scroll 0 0 #237A2A;
    border-radius: 4px 4px 4px 4px;
    bottom: 0;
    color: #FFFFFF;
    font-size: 16px;
    font-weight: bold;
    padding: 2px 10px;
    position: absolute;
    right: 10px;
    text-decoration: none;
}

#monthly p.price a.up:hover {
   background: #FF6569;
   cursor: pointer;   
}

#monthly p.price span.quantity {
    background: none repeat scroll 0 0 #E1ECF3;
    border-radius: 3px 3px 3px 3px;
    color: #59849F;
    font-size: 12px;
    font-weight: bold;
    letter-spacing: -0.5px;
    padding: 0 10px;
    position: absolute;
    right: 10px;
    text-align: center;
    text-shadow: 0 1px 1px #FFFFFF;
    top: -33px;
    width: 105px;
}

#monthly p.price span.num {
   color: inherit;
   font: inherit;   
}

#monthly p.price span.quantity.flash {
  background: #fff;   
}


#monthly p.price span.quantity.flash:before {
   border-color: transparent #fff transparent -moz-use-text-color;
}


#monthly p.price span.amount span.grey {
    color: #777777;
    font-size: 14px;
    font-weight: normal;
    letter-spacing: -0.5px;
}

#help {
    float: left;
    padding: 0 0 20px;
    width: 100%;
    margin: 0 0 30px 0;
}

#help div {
   float: left; 
   padding: 0 20px;  
}

#help div:first-child {
  padding-left: 0;   
}

#help div:last-child {
  padding-right: 0;
  border-right: none;   
}

#help div ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
  float: left;   
}


#help div ul li {
  margin: 0 20px 0 0; 
  font-size: 16px;
  letter-spacing: -0.5px;
  font-weight: normal;
  color: #555;
}

#help div ul li:first-child {
  color: #59849F;
  font-weight: bold;
  font-size: 20px;
  text-shadow: 0 1px 1px #fff;
  border-bottom: 1px solid #E1ECF3;
  margin-bottom: 10px;
  font-family: Helvetica, arial, sans-serif;
}

.left {
  width: 700px;
  float: left;
}

</style>
{% endblock %}


{% block currency %}
	{% include 'shop/snippets/currency.html' %}
{% endblock %}


{% block content %}


{% if product.category.parent_category.slug == 'teas' %}
    {% include 'shop/snippets/teas_sub_nav.html' %}
{% endif %}


<div id="mtw">
  <div class="sp">
		
	<h1>{% if product.long_name %}{{ product.long_name|safe }}{% else %}{{ product.name }}{% endif %}</h1>

	<div class="tea-top">
		<div class="left">
		<div class="main-image">
			<img class="loading" src="{{ static_url }}images/loading.gif"/>
			<div id="image_wrap">
			    {% thumbnail product.image thumb_large crop="center" as im %}
					<img class="product-small" alt="{{ im.url }}" title="{{ product.description }}" src="{{ im.url }}"/></a>
				{% endthumbnail %}	
			</div>
		</div><!-- end main image div -->
		</div>
		
		<div class="description">{{ product.body_text|safe }}</div>
		
	</div><!-- end top product info div -->
	
	<br clear="all"/>
	
	<div id="choose-months">
	   <h3>{% trans 'How many months would you like?' %} &raquo;</h3>
	   <ul>
	       <li>
	           <a href="{% url change_monthly_frequency 3 %}" class="changemonths{% if months == 3 %} selected{% endif %}">3 {% trans 'months' %}</a>
	       </li>
	       <li>
	           <a href="{% url change_monthly_frequency 6 %}" class="changemonths{% if months == 6 %} selected{% endif %}">6 {% trans 'months' %}</a>
	           <br/>&#10003; {% trans 'Free postage' %}
	       </li>
	       <li>
	           <a href="{% url change_monthly_frequency 12 %}" class="changemonths{% if months == 12 %} selected{% endif %}">12 {% trans 'months' %}</a>
	           <br/>&#10003; {% trans 'Free postage' %}
	           <br/>&#10003; {{ monthly_discount_low|floatformat }}% {% trans 'discount' %}
	       </li>
	   </ul>
	</div>
	
	<div id="monthly">
	   <h3>
	       {% trans 'Choose which teas to add to your TeaBox' %} &raquo;<br/>
	   </h3>
	   
	   <div id="products">
	           {% include 'shop/snippets/products_monthly.html' %}
	   </div>
	</div>
	
	<div class="left">
	   {{ product.long_description|safe }}
	</div>

	
	{% if region == 'CN' %}
	{% else %}
	{% if ga_is_on %}
    <ul class="rss">
		<li id="google">
			<g:plusone></g:plusone>
			<script type="text/javascript">
			  (function() {
			    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
			    po.src = 'https://apis.google.com/js/plusone.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
			  })();
			</script>
		</li>
    	<li id="facebook">
		    <div id="fb-root"></div>
		    <script src="http://connect.facebook.net/en_US/all.js#appId=234100573279411&amp;xfbml=1"></script>
		    <fb:like href="http://www.minrivertea.com/teas/{{ product.slug }}" send="false" layout="button_count" width="80" show_faces="true" font="">
		    </fb:like>
		</li>
	</ul>
	{% endif %}
	{% endif %}


</div>
</div>
{% endblock %}
