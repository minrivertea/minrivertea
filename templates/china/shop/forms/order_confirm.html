{% extends base_template %}
{% load django_static thumbnail %}

{% block pagetitle %}Order (Step 2 of 3) - Confirm Order{% endblock %}

{% block extrajs %}
<script type="text/javascript">

$("#wishlist-link").click(function() {	
	$.getJSON("/order/make_wishlist/", {xhr: "true", order: {{ order.id }}},
  		function(data) {
	  		$(data).appendTo('#wishlist-full');
	  		$('#wishlist-link').unbind('click');
	  		$('a#wishlist-link').fancybox();
	  		$('#loading-wishlist').toggle();
  		});    	
	});


$(document).ready( function() {
	$('a#wishlist-link').fancybox();
});


$('#go').click( function() {
    // we want to convert the prices to dollars, make a popup asking the customer to confirm, and then continue submitting the form
    $.ajax({
        url: '{% url china_convert_prices order.id %}',
        success: function(data) {
            $.fancybox(data, {
      		'autoDimensions'	: false,
			'width'         	: 650,
			'height'        		: 'auto',
			'padding'    : 30,
            });
        }
    });
    return false;
});


</script>

<script type="application/javascript" src="{% staticfile '/js/lightbox/jquery.fancybox-1.3.4.pack.js' %}"></script>
{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="{% staticfile '/css/fancybox/jquery.fancybox-1.3.4.css' %}" />
<style type="text/css">
div#mtw {
  margin-top: 30px;	
}

div#mtw div#left {
  margin: 30px 0 0 20px;
  width: 550px;	
}


div#mtw div#left h2 {
    font-weight: normal;
}

div.row {
  background-image: none;	
  -moz-box-shadow: none;
}

.paypal {
  margin-bottom: 20px;	
}

#wishlist {
    float: right;
    font-size: 13px;
    font-weight: bold;
    margin: 5px 30px;
    text-align: right;
    width: 300px;
}

#wishlist img {
  position: relative;
  top: 9px;	
  right: -4px;
}

#mtw #wishlist-full {
  display: none;
  float: left;
  width: 500px;
  height: auto;
  position: relative;	
}

#loading-wishlist {
  position: absolute;
  left: 300px;	
  top: 200px;
}

#wishlist-full p.url {
  background-color: #f1f1f1;
  padding: 10px 15px;	
}

#wishlist-full strong {
  color: #333;	
}

#buttons {
  position: absolute;
  bottom: 30px;
  right: 20px; 
  width: 300px;
  text-align: right;  
}

#go {
  font-size: 30px;
  float: right;
  margin: 0 0 20px;  
}

#checkout-button {
    float: right;
    margin: 0 20px 0px 0;
    width: 240px;
    position: inherit;
}

h2.fancybox {
    color: #FF6569;
}

</style>

{% endblock %}

{% block content %}

<div id="subnav">
   <div class="sp">
       <ul>
    		<li>
    			<a class="completed" href="{% url basket %}">1. Your basket &#10003;</a>
    		</li>
    		<li>
    			<a class="completed" href="{% url order_step_one %}">2. Your details &#10003;</a>
    		</li>
    		<li>
    			<a href="" class="selected">3. Confirm and pay &raquo;</a>
    		</li>
    		<li>
    			<a href="">4. Get your tea!</a>
    		</li>
    	</ul>
    </div>
</div>


<div id="mtw">
  <div class="sp">
	
	<div id="basket">
	
	   {% if paypal_form %}
	       {{ paypal_form }}	   
	   {% endif %}
		
		<div class="row">
			<h2>You're ordering...</h2>
		
			<div class="row-box">
				<table>
				{% for thing in order.items.all %}
				  <tr>				
			    	<td width="120px" valign="top">
			    		{% thumbnail thing.item.parent_product.image "100" as im %}
			    			<img src="{{ im.url }}"/>
			    		{% endthumbnail %}
			    	</td>
			    	<td width="250px" valign="top">
			    		{{ thing.quantity }} X {{ thing.item.parent_product.name }} {% if not thing.item.weight %}
			    		{% else %}({{ thing.item.weight|floatformat }}{{ thing.item.weight_unit }}){% endif %}
			    	</td>
			    	<td width="150px" valign="top">
			    	</td>
			    	<td valign="top">{{ currency.symbol }}{{ thing.get_price }}</td>		    				
				  </tr>
			    {% endfor %}
			  {% if postage_discount %}
			  <tr>
			    <td><span class="small"><em>There is no postage charge, because your order is over {{ currency.symbol }}{{ currency.postage_discount_threshold }}</em></span></td>
			  </tr>
			  {% else %}
			  <tr>
			  	<td>&nbsp;</td>
			  	<td>Postage</td>
			  	<td>&nbsp;</td>
			  	<td>{{ currency.symbol }}{{ currency.postage_cost|floatformat:"2" }}</td>		  
			  </tr>
		  	  {% endif %}
		  	  {% if order.discount %}
			  <tr>
			  	<td>&nbsp;</td>
			  	<td>Discount</td>
			  	<td>&nbsp;</td>
			  	<td>-{{ currency.symbol }}{{ value|floatformat:"2" }}</td>
			  </tr>
			  {% endif %}
			  <tr>
			  	<td>&nbsp;</td>
			  	<td><strong>TOTAL</strong></td>
			  	<td>&nbsp;</td>
			  	<td><strong>{{ currency.symbol }}{{ total_price|floatformat:"2" }}</strong></td>		  
			  </tr>
			</table>
		</div>
	</div>



	<div class="row">
		<h2>â€¦and we'll send your order to:</h2>
		
		<div class="row-box">
		  {% with order.address as address %}
		      {% include "shop/snippets/address.html" %}
		  {% endwith %}
		</div>
	</div>
	
	{% if not paypal_form %}
	  <div id="buttons">
	      <img id="ppicon" src="{% staticfile '/images/002.gif' %}" class="paypal">
    	   <a href="#" id="go" class="button green">Submit and pay &raquo;</a>
        </div>
    {% endif %}
	 


</div>


<div id="wishlist">
	<a id="wishlist-link" href="#wishlist-full">Turn this basket into a wishlist! <img src="{% staticfile '/images/gift_small.png' %}"></a>
	<div id="wishlist-full" style="width: 650px; height: 400px; padding: 30px;">
		<img id="loading-wishlist" src="{% staticfile '/images/loading.gif' %}"/>
	</div>
</div>
	
<div id="left">
	<h2>Problems or questions?</h2>
    <p>We aim to offer first class customer service - if you have ANY problems or questions, contact Chris West, the owner, directly on email at <a href="mailto:chris@minrivertea.com">chris@minrivertea.com</a> - I'll respond normally within a few hours to every email.</p>

</div>

</div>

	
	
	
  </div>
</div>
{% endblock %}
